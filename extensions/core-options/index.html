
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Extensions ecosystem for Jason Taylor's Clean Architecture template.">
      
      
      
        <link rel="canonical" href="https://cleanarchitecture-extensions.github.io/CleanArchitecture.Extensions/extensions/core-options/">
      
      
        <link rel="prev" href="../core/">
      
      
        <link rel="next" href="../core-time/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.13">
    
    
      
        <title>Core Options - CleanArchitecture.Extensions</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e359304.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#core-options" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="CleanArchitecture.Extensions" class="md-header__button md-logo" aria-label="CleanArchitecture.Extensions" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CleanArchitecture.Extensions
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Core Options
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/CleanArchitecture-Extensions/CleanArchitecture.Extensions" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    CleanArchitecture-Extensions/CleanArchitecture.Extensions
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../roadmap/" class="md-tabs__link">
          
  
  Roadmap

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../getting-started/quickstart/" class="md-tabs__link">
          
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../concepts/architecture-fit/" class="md-tabs__link">
          
  
  Concepts

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  Extensions Catalog

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../recipes/authentication/" class="md-tabs__link">
          
  
  Recipes

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../samples/" class="md-tabs__link">
        
  
    
  
  Samples

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../reference/configuration/" class="md-tabs__link">
        
  
    
  
  Reference

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../troubleshooting/" class="md-tabs__link">
        
  
    
  
  Troubleshooting

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../contributing/" class="md-tabs__link">
        
  
    
  
  Contributing

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../release-notes/" class="md-tabs__link">
        
  
    
  
  Release Notes

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="CleanArchitecture.Extensions" class="md-nav__button md-logo" aria-label="CleanArchitecture.Extensions" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    CleanArchitecture.Extensions
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/CleanArchitecture-Extensions/CleanArchitecture.Extensions" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    CleanArchitecture-Extensions/CleanArchitecture.Extensions
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Roadmap
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Roadmap
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../roadmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Roadmap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../roadmap/package-blueprints/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Package Blueprints
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/quickstart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quickstart
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/adoption-playbooks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Adoption Playbooks
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Concepts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/architecture-fit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture Fit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/composition/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Composition & Invariants
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Extensions Catalog
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Extensions Catalog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Core Options
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Core Options
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#template-baseline" class="md-nav__link">
    <span class="md-ellipsis">
      Template baseline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-core-configures" class="md-nav__link">
    <span class="md-ellipsis">
      What Core configures
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-options-are-used-across-core" class="md-nav__link">
    <span class="md-ellipsis">
      How options are used across Core
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#registering-options-in-di" class="md-nav__link">
    <span class="md-ellipsis">
      Registering options in DI
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-via-appsettings-optional" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration via appsettings (optional)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sample-backed-walkthrough-options-sample" class="md-nav__link">
    <span class="md-ellipsis">
      Sample-backed walkthrough (options sample)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sample-backed walkthrough (options sample)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inspect-current-options-at-runtime" class="md-nav__link">
    <span class="md-ellipsis">
      Inspect current options at runtime
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drive-guard-behavior-from-options" class="md-nav__link">
    <span class="md-ellipsis">
      Drive guard behavior from options
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-specific-guidance" class="md-nav__link">
    <span class="md-ellipsis">
      Environment-specific guidance
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-options-with-guards" class="md-nav__link">
    <span class="md-ellipsis">
      Using options with guards
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-options-with-pipeline-behaviors" class="md-nav__link">
    <span class="md-ellipsis">
      Using options with pipeline behaviors
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patterns-and-scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      Patterns and scenarios
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Patterns and scenarios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-matching-gatewayheader-expectations" class="md-nav__link">
    <span class="md-ellipsis">
      1) Matching gateway/header expectations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-tightening-performance-thresholds-for-hot-paths" class="md-nav__link">
    <span class="md-ellipsis">
      2) Tightening performance thresholds for hot paths
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-disabling-performance-logs-for-chatty-background-jobs" class="md-nav__link">
    <span class="md-ellipsis">
      3) Disabling performance logs for chatty background jobs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-correlation-id-strategy-per-environment" class="md-nav__link">
    <span class="md-ellipsis">
      4) Correlation ID strategy per environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-seeding-traceid-for-resultguard-flows" class="md-nav__link">
    <span class="md-ellipsis">
      5) Seeding TraceId for result/guard flows
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per-request-overrides" class="md-nav__link">
    <span class="md-ellipsis">
      Per-request overrides
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-options" class="md-nav__link">
    <span class="md-ellipsis">
      Testing options
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migration-tips-from-the-template" class="md-nav__link">
    <span class="md-ellipsis">
      Migration tips from the template
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reference-option-defaults-and-effects" class="md-nav__link">
    <span class="md-ellipsis">
      Reference: option defaults and effects
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adoption-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      Adoption checklist
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related-docs" class="md-nav__link">
    <span class="md-ellipsis">
      Related docs
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core-time/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core Time
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core-domain-events/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core Domain Events
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core-logging-abstractions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core Logging Abstractions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core-pipeline-behaviors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core Pipeline Behaviors
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core-guard-clauses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core Guard Clauses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core-result-primitives/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core Result Primitives
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../validation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Validation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../caching/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Caching
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multitenancy-core/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multitenancy Core
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Recipes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Recipes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recipes/authentication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recipes/caching/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Caching
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Samples
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reference
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshooting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Release Notes
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#template-baseline" class="md-nav__link">
    <span class="md-ellipsis">
      Template baseline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-core-configures" class="md-nav__link">
    <span class="md-ellipsis">
      What Core configures
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-options-are-used-across-core" class="md-nav__link">
    <span class="md-ellipsis">
      How options are used across Core
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#registering-options-in-di" class="md-nav__link">
    <span class="md-ellipsis">
      Registering options in DI
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-via-appsettings-optional" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration via appsettings (optional)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sample-backed-walkthrough-options-sample" class="md-nav__link">
    <span class="md-ellipsis">
      Sample-backed walkthrough (options sample)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sample-backed walkthrough (options sample)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inspect-current-options-at-runtime" class="md-nav__link">
    <span class="md-ellipsis">
      Inspect current options at runtime
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drive-guard-behavior-from-options" class="md-nav__link">
    <span class="md-ellipsis">
      Drive guard behavior from options
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-specific-guidance" class="md-nav__link">
    <span class="md-ellipsis">
      Environment-specific guidance
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-options-with-guards" class="md-nav__link">
    <span class="md-ellipsis">
      Using options with guards
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-options-with-pipeline-behaviors" class="md-nav__link">
    <span class="md-ellipsis">
      Using options with pipeline behaviors
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patterns-and-scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      Patterns and scenarios
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Patterns and scenarios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-matching-gatewayheader-expectations" class="md-nav__link">
    <span class="md-ellipsis">
      1) Matching gateway/header expectations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-tightening-performance-thresholds-for-hot-paths" class="md-nav__link">
    <span class="md-ellipsis">
      2) Tightening performance thresholds for hot paths
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-disabling-performance-logs-for-chatty-background-jobs" class="md-nav__link">
    <span class="md-ellipsis">
      3) Disabling performance logs for chatty background jobs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-correlation-id-strategy-per-environment" class="md-nav__link">
    <span class="md-ellipsis">
      4) Correlation ID strategy per environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-seeding-traceid-for-resultguard-flows" class="md-nav__link">
    <span class="md-ellipsis">
      5) Seeding TraceId for result/guard flows
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#per-request-overrides" class="md-nav__link">
    <span class="md-ellipsis">
      Per-request overrides
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-options" class="md-nav__link">
    <span class="md-ellipsis">
      Testing options
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migration-tips-from-the-template" class="md-nav__link">
    <span class="md-ellipsis">
      Migration tips from the template
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reference-option-defaults-and-effects" class="md-nav__link">
    <span class="md-ellipsis">
      Reference: option defaults and effects
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adoption-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      Adoption checklist
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related-docs" class="md-nav__link">
    <span class="md-ellipsis">
      Related docs
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="core-options">Core Options<a class="headerlink" href="#core-options" title="Permanent link">&para;</a></h1>
<p>The Core extension exposes a single options class—<code>CoreExtensionsOptions</code>—to configure correlation, guard behavior, and performance logging. While Jason Taylor’s Clean Architecture template wires MediatR behaviors without centralized options, the Core package adds a cohesive configuration surface so you can control cross-cutting behavior from appsettings or DI. This page explains the template baseline, what options exist, how they affect guards, logging, pipeline behaviors, and how to use them in different environments (dev, test, prod).</p>
<h2 id="template-baseline">Template baseline<a class="headerlink" href="#template-baseline" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Behaviors:</strong> Template MediatR behaviors (<code>LoggingBehaviour</code>, <code>AuthorizationBehaviour</code>, <code>ValidationBehaviour</code>, <code>PerformanceBehaviour</code>, <code>UnhandledExceptionBehaviour</code>) are hard-coded—no central options for thresholds or correlation.</li>
<li><strong>Correlation:</strong> No explicit correlation header or ID factory; logging relies on <code>ILogger&lt;T&gt;</code> scopes populated with user info.</li>
<li><strong>Guards:</strong> Template doesn’t ship guard options; validation uses FluentValidation with exception throwing.</li>
</ul>
<h2 id="what-core-configures">What Core configures<a class="headerlink" href="#what-core-configures" title="Permanent link">&para;</a></h2>
<p><code>CoreExtensionsOptions</code> lives in <code>CleanArchitecture.Extensions.Core.Options</code> and governs:
- <code>CorrelationHeaderName</code> (string, default <code>"X-Correlation-ID"</code>)
- <code>GuardStrategy</code> (enum, default <code>ReturnFailure</code>)
- <code>EnablePerformanceLogging</code> (bool, default <code>true</code>)
- <code>PerformanceWarningThreshold</code> (TimeSpan, default 500 ms)
- <code>CorrelationIdFactory</code> (<code>Func&lt;string&gt;</code>, default GUID “N”)
- <code>TraceId</code> (string?, default <code>null</code>)</p>
<h2 id="how-options-are-used-across-core">How options are used across Core<a class="headerlink" href="#how-options-are-used-across-core" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Correlation behaviors:</strong> <code>CorrelationBehavior</code> uses <code>CorrelationIdFactory</code> when <code>ILogContext.CorrelationId</code> is missing. Controllers/middleware can use <code>CorrelationHeaderName</code> to read/write headers.</li>
<li><strong>Logging behavior:</strong> Uses <code>CorrelationBehavior</code>-set IDs; if none are set, it can seed correlation via <code>IClock.NewGuid()</code>—you can align that with <code>CorrelationIdFactory</code> for consistency.</li>
<li><strong>Performance behavior:</strong> Respects <code>EnablePerformanceLogging</code> and <code>PerformanceWarningThreshold</code> to toggle logging and control warnings vs. debug logs.</li>
<li><strong>Guards:</strong> <code>GuardOptions.FromOptions</code> maps <code>GuardStrategy</code> and <code>TraceId</code> into guard calls; you can supply an error sink for accumulation.</li>
<li><strong>Results:</strong> <code>TraceId</code> can be propagated to Result/Errors for consistent tracing between logs, domain events, and HTTP responses.</li>
</ul>
<h2 id="registering-options-in-di">Registering options in DI<a class="headerlink" href="#registering-options-in-di" title="Permanent link">&para;</a></h2>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1">// Inline defaults for clarity; you can still bind from configuration if you prefer.</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="n">services</span><span class="p">.</span><span class="n">AddCleanArchitectureCore</span><span class="p">(</span><span class="n">options</span><span class="w"> </span><span class="o">=&gt;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">{</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">CorrelationHeaderName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;X-Correlation-ID&quot;</span><span class="p">;</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">GuardStrategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GuardStrategy</span><span class="p">.</span><span class="n">ReturnFailure</span><span class="p">;</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">EnablePerformanceLogging</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">PerformanceWarningThreshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TimeSpan</span><span class="p">.</span><span class="n">FromMilliseconds</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="p">});</span>
</code></pre></div>
If you want to bind from configuration instead, call:
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">services</span><span class="p">.</span><span class="n">AddCleanArchitectureCore</span><span class="p">(</span><span class="n">opts</span><span class="w"> </span><span class="o">=&gt;</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">    </span><span class="n">configuration</span><span class="p">.</span><span class="n">GetSection</span><span class="p">(</span><span class="s">&quot;Extensions:Core&quot;</span><span class="p">).</span><span class="n">Bind</span><span class="p">(</span><span class="n">opts</span><span class="p">));</span>
</code></pre></div>
You can still override programmatically:
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">services</span><span class="p">.</span><span class="n">PostConfigure</span><span class="o">&lt;</span><span class="n">CoreExtensionsOptions</span><span class="o">&gt;</span><span class="p">(</span><span class="n">options</span><span class="w"> </span><span class="o">=&gt;</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="p">{</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">CorrelationIdFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">$&quot;svc-{Guid.NewGuid():N}&quot;</span><span class="p">;</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">PerformanceWarningThreshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TimeSpan</span><span class="p">.</span><span class="n">FromMilliseconds</span><span class="p">(</span><span class="mi">250</span><span class="p">);</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="p">});</span>
</code></pre></div></p>
<h2 id="configuration-via-appsettings-optional">Configuration via appsettings (optional)<a class="headerlink" href="#configuration-via-appsettings-optional" title="Permanent link">&para;</a></h2>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="p">{</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="nt">&quot;Extensions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="nt">&quot;Core&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">      </span><span class="nt">&quot;CorrelationHeaderName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;X-Correlation-ID&quot;</span><span class="p">,</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">      </span><span class="nt">&quot;GuardStrategy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ReturnFailure&quot;</span><span class="p">,</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">      </span><span class="nt">&quot;EnablePerformanceLogging&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">      </span><span class="nt">&quot;PerformanceWarningThreshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;00:00:00.500&quot;</span><span class="p">,</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">      </span><span class="nt">&quot;TraceId&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="p">}</span>
</code></pre></div>
- Strings like <code>"ReturnFailure"</code> bind to <code>GuardStrategy</code>.
- TimeSpan format is standard .NET (<code>hh:mm:ss.fff</code>).
- <code>CorrelationIdFactory</code> cannot be bound via configuration; set it in code when registering options.</p>
<h2 id="sample-backed-walkthrough-options-sample">Sample-backed walkthrough (options sample)<a class="headerlink" href="#sample-backed-walkthrough-options-sample" title="Permanent link">&para;</a></h2>
<p>A runnable solution lives at <code>samples/CleanArchitecture.Extensions.Core.Options.Sample</code>.</p>
<h3 id="inspect-current-options-at-runtime">Inspect current options at runtime<a class="headerlink" href="#inspect-current-options-at-runtime" title="Permanent link">&para;</a></h3>
<p><code>samples/CleanArchitecture.Extensions.Core.Options.Sample/src/Application/Diagnostics/Queries/GetCoreOptions/GetCoreOptionsQuery.cs</code>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kt">var</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_options</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="kt">var</span><span class="w"> </span><span class="n">dto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CoreOptionsDto</span><span class="p">(</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="k">value</span><span class="p">.</span><span class="n">CorrelationHeaderName</span><span class="p">,</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="k">value</span><span class="p">.</span><span class="n">GuardStrategy</span><span class="p">,</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">    </span><span class="k">value</span><span class="p">.</span><span class="n">EnablePerformanceLogging</span><span class="p">,</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">    </span><span class="k">value</span><span class="p">.</span><span class="n">PerformanceWarningThreshold</span><span class="p">);</span>
</code></pre></div>
- Exposed via <code>GET /api/Diagnostics/options</code> to see the live values bound from <code>appsettings.json</code> (correlation header, guard strategy, performance threshold).</p>
<h3 id="drive-guard-behavior-from-options">Drive guard behavior from options<a class="headerlink" href="#drive-guard-behavior-from-options" title="Permanent link">&para;</a></h3>
<p><code>samples/CleanArchitecture.Extensions.Core.Options.Sample/src/Application/Diagnostics/Commands/EvaluateName/EvaluateNameCommand.cs</code>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">guardOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GuardOptions</span><span class="p">.</span><span class="n">FromOptions</span><span class="p">(</span><span class="n">_options</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="kt">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CoreGuard</span><span class="p">.</span><span class="n">AgainstNullOrWhiteSpace</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="k">nameof</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">Name</span><span class="p">),</span><span class="w"> </span><span class="n">guardOptions</span><span class="p">)</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">    </span><span class="p">.</span><span class="n">Ensure</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Error</span><span class="p">(</span><span class="s">&quot;diagnostics.name.length&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name must be 50 characters or fewer.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">guardOptions</span><span class="p">.</span><span class="n">TraceId</span><span class="p">));</span>
</code></pre></div>
- <code>POST /api/Diagnostics/guard</code> returns a Core <code>Result&lt;string&gt;</code>; switch <code>GuardStrategy</code> in config between <code>ReturnFailure</code> and <code>Throw</code> to see the behavior change without code changes.
- Appsettings in the sample set <code>PerformanceWarningThreshold</code> to 750 ms and <code>CorrelationHeaderName</code> to <code>"X-Correlation-ID"</code> to show how pipeline behaviors and middleware pick them up.</p>
<h2 id="environment-specific-guidance">Environment-specific guidance<a class="headerlink" href="#environment-specific-guidance" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Development:</strong> Keep <code>EnablePerformanceLogging = true</code> and threshold at 500 ms for visibility. Consider human-readable correlation IDs (<code>dev-{Guid}</code>) for quick searches.</li>
<li><strong>Production:</strong> Standardize <code>CorrelationHeaderName</code> with your API gateway. Keep thresholds aligned with SLOs; raise if noise is high. Ensure correlation IDs are opaque (GUIDs) to avoid leaking info.</li>
<li><strong>Tests:</strong> Inject <code>TraceId</code> for deterministic assertions. You can turn off performance logging to reduce noise or set a very low threshold to assert warnings in tests.</li>
</ul>
<h2 id="using-options-with-guards">Using options with guards<a class="headerlink" href="#using-options-with-guards" title="Permanent link">&para;</a></h2>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">guardOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GuardOptions</span><span class="p">.</span><span class="n">FromOptions</span><span class="p">(</span><span class="n">coreOptions</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="kt">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Guard</span><span class="p">.</span><span class="n">AgainstNullOrWhiteSpace</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">nameof</span><span class="p">(</span><span class="n">name</span><span class="p">),</span><span class="w"> </span><span class="n">guardOptions</span><span class="p">);</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">IsFailure</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">Result</span><span class="p">.</span><span class="n">Failure</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">Errors</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">TraceId</span><span class="p">);</span>
</code></pre></div>
- <code>GuardStrategy</code> drives return/throw/accumulate.
- <code>TraceId</code> flows into errors produced by guards.
- For accumulation, pass an <code>ErrorSink</code> into <code>GuardOptions.FromOptions(options, sink)</code>.</p>
<h2 id="using-options-with-pipeline-behaviors">Using options with pipeline behaviors<a class="headerlink" href="#using-options-with-pipeline-behaviors" title="Permanent link">&para;</a></h2>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">services</span><span class="p">.</span><span class="n">AddCleanArchitectureCore</span><span class="p">(</span><span class="n">options</span><span class="w"> </span><span class="o">=&gt;</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span><span class="n">configuration</span><span class="p">.</span><span class="n">GetSection</span><span class="p">(</span><span class="s">&quot;Extensions:Core&quot;</span><span class="p">).</span><span class="n">Bind</span><span class="p">(</span><span class="n">options</span><span class="p">));</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="n">services</span><span class="p">.</span><span class="n">AddMediatR</span><span class="p">(</span><span class="n">cfg</span><span class="w"> </span><span class="o">=&gt;</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="p">{</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">    </span><span class="n">cfg</span><span class="p">.</span><span class="n">AddCleanArchitectureCorePipeline</span><span class="p">();</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">    </span><span class="n">cfg</span><span class="p">.</span><span class="n">AddOpenBehavior</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">UnhandledExceptionBehaviour</span><span class="o">&lt;</span><span class="p">,</span><span class="o">&gt;</span><span class="p">));</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">    </span><span class="n">cfg</span><span class="p">.</span><span class="n">AddOpenBehavior</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">AuthorizationBehaviour</span><span class="o">&lt;</span><span class="p">,</span><span class="o">&gt;</span><span class="p">));</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">    </span><span class="n">cfg</span><span class="p">.</span><span class="n">AddOpenBehavior</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">ValidationBehaviour</span><span class="o">&lt;</span><span class="p">,</span><span class="o">&gt;</span><span class="p">));</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="p">});</span>
</code></pre></div>
- PerformanceBehavior will skip logging if <code>EnablePerformanceLogging</code> is false.
- CorrelationBehavior will use <code>CorrelationIdFactory</code> when no correlation ID is present.</p>
<h2 id="patterns-and-scenarios">Patterns and scenarios<a class="headerlink" href="#patterns-and-scenarios" title="Permanent link">&para;</a></h2>
<h3 id="1-matching-gatewayheader-expectations">1) Matching gateway/header expectations<a class="headerlink" href="#1-matching-gatewayheader-expectations" title="Permanent link">&para;</a></h3>
<p>If your API gateway uses <code>X-Request-ID</code>, align it:
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">services</span><span class="p">.</span><span class="n">AddCleanArchitectureCore</span><span class="p">(</span><span class="n">options</span><span class="w"> </span><span class="o">=&gt;</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="p">{</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">CorrelationHeaderName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;X-Request-ID&quot;</span><span class="p">;</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">CorrelationIdFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Guid</span><span class="p">.</span><span class="n">NewGuid</span><span class="p">().</span><span class="n">ToString</span><span class="p">(</span><span class="s">&quot;N&quot;</span><span class="p">);</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="p">});</span>
</code></pre></div>
Ensure middleware echoes the same header; <code>CorrelationBehavior</code> will reuse IDs set in <code>ILogContext</code>.</p>
<h3 id="2-tightening-performance-thresholds-for-hot-paths">2) Tightening performance thresholds for hot paths<a class="headerlink" href="#2-tightening-performance-thresholds-for-hot-paths" title="Permanent link">&para;</a></h3>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">services</span><span class="p">.</span><span class="n">AddCleanArchitectureCore</span><span class="p">(</span><span class="n">options</span><span class="w"> </span><span class="o">=&gt;</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="p">{</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">PerformanceWarningThreshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TimeSpan</span><span class="p">.</span><span class="n">FromMilliseconds</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="p">});</span>
</code></pre></div>
Use feature-specific options (named options) if some handlers are expected to run longer (e.g., reporting).</p>
<h3 id="3-disabling-performance-logs-for-chatty-background-jobs">3) Disabling performance logs for chatty background jobs<a class="headerlink" href="#3-disabling-performance-logs-for-chatty-background-jobs" title="Permanent link">&para;</a></h3>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">services</span><span class="p">.</span><span class="n">AddCleanArchitectureCore</span><span class="p">(</span><span class="n">options</span><span class="w"> </span><span class="o">=&gt;</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="p">{</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">EnablePerformanceLogging</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="p">});</span>
</code></pre></div>
This keeps noise down in queues/cron workers that run high-frequency MediatR requests.</p>
<h3 id="4-correlation-id-strategy-per-environment">4) Correlation ID strategy per environment<a class="headerlink" href="#4-correlation-id-strategy-per-environment" title="Permanent link">&para;</a></h3>
<ul>
<li>Dev: prefix with <code>dev-</code> for quick grep (<code>dev-{Guid}</code>).</li>
<li>Staging/prod: opaque GUIDs.
Set <code>CorrelationIdFactory</code> accordingly in environment-specific DI modules.</li>
</ul>
<h3 id="5-seeding-traceid-for-resultguard-flows">5) Seeding TraceId for result/guard flows<a class="headerlink" href="#5-seeding-traceid-for-resultguard-flows" title="Permanent link">&para;</a></h3>
<p>For APIs that already have a trace/correlation token (e.g., from a reverse proxy):
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">services</span><span class="p">.</span><span class="n">AddCleanArchitectureCore</span><span class="p">(</span><span class="n">options</span><span class="w"> </span><span class="o">=&gt;</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="p">{</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">TraceId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;injected-from-middleware&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// or set per-request in middleware using IOptionsSnapshot</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="p">});</span>
</code></pre></div>
Better: set <code>TraceId</code> per request using <code>IOptionsSnapshot&lt;CoreExtensionsOptions&gt;</code> and a middleware that copies the incoming header value into options for that scope.</p>
<h2 id="per-request-overrides">Per-request overrides<a class="headerlink" href="#per-request-overrides" title="Permanent link">&para;</a></h2>
<p>Use <code>IOptionsSnapshot&lt;CoreExtensionsOptions&gt;</code> or a scoped options wrapper to set per-request values (e.g., TraceId) based on incoming HTTP headers:
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">CorrelationOptionsMiddleware</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="p">{</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">RequestDelegate</span><span class="w"> </span><span class="n">_next</span><span class="p">;</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">IOptionsSnapshot</span><span class="o">&lt;</span><span class="n">CoreExtensionsOptions</span><span class="o">&gt;</span><span class="w"> </span><span class="n">_options</span><span class="p">;</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">ILogContext</span><span class="w"> </span><span class="n">_context</span><span class="p">;</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">CorrelationOptionsMiddleware</span><span class="p">(</span><span class="n">RequestDelegate</span><span class="w"> </span><span class="n">next</span><span class="p">,</span><span class="w"> </span><span class="n">IOptionsSnapshot</span><span class="o">&lt;</span><span class="n">CoreExtensionsOptions</span><span class="o">&gt;</span><span class="w"> </span><span class="n">options</span><span class="p">,</span><span class="w"> </span><span class="n">ILogContext</span><span class="w"> </span><span class="n">context</span><span class="p">)</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="w">        </span><span class="n">_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next</span><span class="p">;</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="w">        </span><span class="n">_options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">options</span><span class="p">;</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="w">        </span><span class="n">_context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">;</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="nf">Invoke</span><span class="p">(</span><span class="n">HttpContext</span><span class="w"> </span><span class="n">http</span><span class="p">)</span>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">incoming</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">http</span><span class="p">.</span><span class="n">Request</span><span class="p">.</span><span class="n">Headers</span><span class="p">[</span><span class="n">_options</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">CorrelationHeaderName</span><span class="p">].</span><span class="n">FirstOrDefault</span><span class="p">();</span>
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">correlationId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrWhiteSpace</span><span class="p">(</span><span class="n">incoming</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">_options</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">CorrelationIdFactory</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">incoming</span><span class="p">;</span>
<a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="w">        </span><span class="n">_context</span><span class="p">.</span><span class="n">CorrelationId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">correlationId</span><span class="p">;</span>
<a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a><span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nf">_next</span><span class="p">(</span><span class="n">http</span><span class="p">);</span>
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a><span class="p">}</span>
</code></pre></div>
- For <code>TraceId</code>, consider a scoped service that copies <code>_context.CorrelationId</code> into <code>CoreExtensionsOptions.TraceId</code> if you need Results to carry it automatically.</p>
<h2 id="testing-options">Testing options<a class="headerlink" href="#testing-options" title="Permanent link">&para;</a></h2>
<ul>
<li>Use <code>Options.Create(new CoreExtensionsOptions { ... })</code> for unit tests of behaviors/guards.</li>
<li>For performance logs, set <code>EnablePerformanceLogging = true</code> and a low threshold, then assert that <code>InMemoryAppLogger</code> captures warnings.</li>
<li>For guard tests, set <code>TraceId</code> and assert it flows into <code>Error.TraceId</code>.</li>
</ul>
<h2 id="migration-tips-from-the-template">Migration tips from the template<a class="headerlink" href="#migration-tips-from-the-template" title="Permanent link">&para;</a></h2>
<ul>
<li>Keep template behaviors if desired, but wire <code>CoreExtensionsOptions</code> to control Core behaviors. Template behaviors ignore these options, so ensure you register Core behaviors to benefit from the settings.</li>
<li>If you currently hard-code thresholds or headers, move them into <code>Extensions:Core</code> configuration and consume via DI.</li>
<li>Replace ad hoc correlation ID generation with <code>CorrelationIdFactory</code> to centralize ID format.</li>
</ul>
<h2 id="reference-option-defaults-and-effects">Reference: option defaults and effects<a class="headerlink" href="#reference-option-defaults-and-effects" title="Permanent link">&para;</a></h2>
<ul>
<li><code>CorrelationHeaderName</code>: Used by middleware/controllers to read/write correlation; behavior uses <code>ILogContext</code> (not header directly).</li>
<li><code>CorrelationIdFactory</code>: Used by <code>CorrelationBehavior</code> when <code>ILogContext.CorrelationId</code> is empty.</li>
<li><code>GuardStrategy</code>: Default for <code>GuardOptions.FromOptions</code>; controls return vs throw vs accumulate.</li>
<li><code>EnablePerformanceLogging</code>: If false, <code>PerformanceBehavior</code> becomes a pass-through.</li>
<li><code>PerformanceWarningThreshold</code>: Controls Warn vs Debug logging in <code>PerformanceBehavior</code>.</li>
<li><code>TraceId</code>: Applied to guards/results when provided; useful for aligning API trace tokens with internal errors.</li>
</ul>
<h2 id="adoption-checklist">Adoption checklist<a class="headerlink" href="#adoption-checklist" title="Permanent link">&para;</a></h2>
<p>1) Register <code>AddCleanArchitectureCore(...)</code> (inline options or configuration binding).
2) Decide on correlation header and ID format; update gateway/middleware accordingly.
3) Set <code>GuardStrategy</code> globally; override per-call with <code>GuardOptions</code> when needed.
4) Tune <code>PerformanceWarningThreshold</code> and <code>EnablePerformanceLogging</code> per environment.
5) If you need TraceId propagation, set it per request (middleware + options snapshot) and pass it into Results/Errors.</p>
<h2 id="related-docs">Related docs<a class="headerlink" href="#related-docs" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="../core-pipeline-behaviors/">Core pipeline behaviors</a> for correlation/performance logging powered by these options.</li>
<li><a href="../core-guard-clauses/">Core guard clauses</a> for guard behavior controlled via options.</li>
<li><a href="../core-result-primitives/">Core result primitives</a> to see how TraceId from options flows into results/errors.</li>
<li><a href="../core-logging-abstractions/">Core logging abstractions</a> for correlation scopes influenced by header/factory choices.</li>
<li><a href="../core/">Core extension overview</a> for the big-picture registration instructions.</li>
</ul>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">December 8, 2025</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.tracking", "content.code.copy", "content.tabs.link", "search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8d2eff1.min.js"></script>
      
    
  </body>
</html>