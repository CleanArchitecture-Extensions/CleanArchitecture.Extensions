
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Extensions ecosystem for Jason Taylor's Clean Architecture template.">
      
      
      
        <link rel="canonical" href="https://cleanarchitecture-extensions.github.io/CleanArchitecture.Extensions/extensions/core-logging-abstractions/">
      
      
        <link rel="prev" href="../core-domain-events/">
      
      
        <link rel="next" href="../core-pipeline-behaviors/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.13">
    
    
      
        <title>Core Logging Abstractions - CleanArchitecture.Extensions</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e359304.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#core-logging-abstractions" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="CleanArchitecture.Extensions" class="md-header__button md-logo" aria-label="CleanArchitecture.Extensions" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CleanArchitecture.Extensions
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Core Logging Abstractions
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/CleanArchitecture-Extensions/CleanArchitecture.Extensions" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    CleanArchitecture-Extensions/CleanArchitecture.Extensions
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../roadmap/" class="md-tabs__link">
          
  
  Roadmap

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../getting-started/quickstart/" class="md-tabs__link">
          
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../concepts/architecture-fit/" class="md-tabs__link">
          
  
  Concepts

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  Extensions Catalog

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../recipes/authentication/" class="md-tabs__link">
          
  
  Recipes

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../samples/" class="md-tabs__link">
        
  
    
  
  Samples

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../reference/configuration/" class="md-tabs__link">
        
  
    
  
  Reference

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../troubleshooting/" class="md-tabs__link">
        
  
    
  
  Troubleshooting

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../contributing/" class="md-tabs__link">
        
  
    
  
  Contributing

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../release-notes/" class="md-tabs__link">
        
  
    
  
  Release Notes

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="CleanArchitecture.Extensions" class="md-nav__button md-logo" aria-label="CleanArchitecture.Extensions" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    CleanArchitecture.Extensions
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/CleanArchitecture-Extensions/CleanArchitecture.Extensions" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    CleanArchitecture-Extensions/CleanArchitecture.Extensions
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Roadmap
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Roadmap
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../roadmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Roadmap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../roadmap/package-blueprints/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Package Blueprints
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/quickstart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quickstart
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/adoption-playbooks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Adoption Playbooks
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Concepts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/architecture-fit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture Fit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/composition/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Composition & Invariants
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Extensions Catalog
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Extensions Catalog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core-options/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core Options
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core-time/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core Time
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core-domain-events/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core Domain Events
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Core Logging Abstractions
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Core Logging Abstractions
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-the-template-already-covers" class="md-nav__link">
    <span class="md-ellipsis">
      What the template already covers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-the-core-logging-abstractions-add" class="md-nav__link">
    <span class="md-ellipsis">
      What the Core logging abstractions add
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-surface" class="md-nav__link">
    <span class="md-ellipsis">
      API surface
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-this-matters-for-clean-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Why this matters for Clean Architecture
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wiring-in-di" class="md-nav__link">
    <span class="md-ellipsis">
      Wiring in DI
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adapting-to-microsoftextensionslogging-mel" class="md-nav__link">
    <span class="md-ellipsis">
      Adapting to Microsoft.Extensions.Logging (MEL)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adapting-to-serilog" class="md-nav__link">
    <span class="md-ellipsis">
      Adapting to Serilog
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sample-backed-walkthrough-logging-sample" class="md-nav__link">
    <span class="md-ellipsis">
      Sample-backed walkthrough (logging sample)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sample-backed walkthrough (logging sample)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#composite-logger-that-records-forwards-to-mel" class="md-nav__link">
    <span class="md-ellipsis">
      Composite logger that records + forwards to MEL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#correlation-middleware-diagnostics-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      Correlation middleware + diagnostics endpoints
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#correlation-flows" class="md-nav__link">
    <span class="md-ellipsis">
      Correlation flows
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-inmemoryapplogger-in-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Using InMemoryAppLogger in tests
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handling-exceptions-and-errors" class="md-nav__link">
    <span class="md-ellipsis">
      Handling exceptions and errors
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#properties-and-scopes" class="md-nav__link">
    <span class="md-ellipsis">
      Properties and scopes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-touchpoints" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration touchpoints
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#real-world-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Real-world patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Real-world patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enriching-logs-with-usertenant-without-coupling-handlers" class="md-nav__link">
    <span class="md-ellipsis">
      Enriching logs with user/tenant without coupling handlers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logging-domain-events-with-correlation" class="md-nav__link">
    <span class="md-ellipsis">
      Logging domain events with correlation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quiet-mode-for-tests-or-local-dev" class="md-nav__link">
    <span class="md-ellipsis">
      Quiet mode for tests or local dev
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migration-guidance-from-the-template" class="md-nav__link">
    <span class="md-ellipsis">
      Migration guidance from the template
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-tips" class="md-nav__link">
    <span class="md-ellipsis">
      Testing tips
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#faq" class="md-nav__link">
    <span class="md-ellipsis">
      FAQ
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adoption-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      Adoption checklist
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related-docs" class="md-nav__link">
    <span class="md-ellipsis">
      Related docs
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core-pipeline-behaviors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core Pipeline Behaviors
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core-guard-clauses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core Guard Clauses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core-result-primitives/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core Result Primitives
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../validation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Validation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../caching/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Caching
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multitenancy-core/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multitenancy Core
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Recipes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Recipes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recipes/authentication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recipes/caching/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Caching
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Samples
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reference
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshooting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Release Notes
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-the-template-already-covers" class="md-nav__link">
    <span class="md-ellipsis">
      What the template already covers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-the-core-logging-abstractions-add" class="md-nav__link">
    <span class="md-ellipsis">
      What the Core logging abstractions add
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-surface" class="md-nav__link">
    <span class="md-ellipsis">
      API surface
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-this-matters-for-clean-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Why this matters for Clean Architecture
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wiring-in-di" class="md-nav__link">
    <span class="md-ellipsis">
      Wiring in DI
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adapting-to-microsoftextensionslogging-mel" class="md-nav__link">
    <span class="md-ellipsis">
      Adapting to Microsoft.Extensions.Logging (MEL)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adapting-to-serilog" class="md-nav__link">
    <span class="md-ellipsis">
      Adapting to Serilog
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sample-backed-walkthrough-logging-sample" class="md-nav__link">
    <span class="md-ellipsis">
      Sample-backed walkthrough (logging sample)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sample-backed walkthrough (logging sample)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#composite-logger-that-records-forwards-to-mel" class="md-nav__link">
    <span class="md-ellipsis">
      Composite logger that records + forwards to MEL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#correlation-middleware-diagnostics-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      Correlation middleware + diagnostics endpoints
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#correlation-flows" class="md-nav__link">
    <span class="md-ellipsis">
      Correlation flows
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-inmemoryapplogger-in-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Using InMemoryAppLogger in tests
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handling-exceptions-and-errors" class="md-nav__link">
    <span class="md-ellipsis">
      Handling exceptions and errors
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#properties-and-scopes" class="md-nav__link">
    <span class="md-ellipsis">
      Properties and scopes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-touchpoints" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration touchpoints
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#real-world-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Real-world patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Real-world patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enriching-logs-with-usertenant-without-coupling-handlers" class="md-nav__link">
    <span class="md-ellipsis">
      Enriching logs with user/tenant without coupling handlers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logging-domain-events-with-correlation" class="md-nav__link">
    <span class="md-ellipsis">
      Logging domain events with correlation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quiet-mode-for-tests-or-local-dev" class="md-nav__link">
    <span class="md-ellipsis">
      Quiet mode for tests or local dev
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migration-guidance-from-the-template" class="md-nav__link">
    <span class="md-ellipsis">
      Migration guidance from the template
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-tips" class="md-nav__link">
    <span class="md-ellipsis">
      Testing tips
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#faq" class="md-nav__link">
    <span class="md-ellipsis">
      FAQ
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adoption-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      Adoption checklist
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related-docs" class="md-nav__link">
    <span class="md-ellipsis">
      Related docs
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="core-logging-abstractions">Core Logging Abstractions<a class="headerlink" href="#core-logging-abstractions" title="Permanent link">&para;</a></h1>
<p>Logging in Clean Architecture is intentionally minimal in Jason Taylor’s template: it relies on <code>ILogger&lt;T&gt;</code> plus user/context services inside MediatR behaviors. The Core extension adds provider-agnostic logging and context abstractions so you can swap providers, capture correlation, and test without mocking concrete logging frameworks. This page explains the template baseline, what the Core abstractions add, how to wire them, and how to adapt them to providers like Microsoft.Extensions.Logging (MEL) or Serilog. It also shows how correlation and Results fit together so logs, errors, and responses share identifiers.</p>
<h2 id="what-the-template-already-covers">What the template already covers<a class="headerlink" href="#what-the-template-already-covers" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Behaviors:</strong> <code>LoggingBehaviour&lt;TRequest&gt;</code> (pre-processor) uses <code>ILogger&lt;TRequest&gt;</code>, <code>IUser</code>, and <code>IIdentityService</code> to log the request name, user ID, and user name. <code>PerformanceBehaviour</code> uses <code>ILogger&lt;TRequest&gt;</code> with a <code>Stopwatch</code> to warn on slow requests (&gt;500 ms). <code>UnhandledExceptionBehaviour</code> logs exceptions with <code>ILogger&lt;TRequest&gt;</code>.</li>
<li><strong>Context:</strong> There is no dedicated log context abstraction. Correlation is not explicitly propagated; any correlation is left to ambient scopes set by the hosting pipeline.</li>
<li><strong>Result + errors:</strong> The template’s <code>Result</code> has <code>Succeeded</code> and <code>string[] Errors</code>; logs do not attach trace IDs or structured error metadata.</li>
<li><strong>Time:</strong> Behaviors depend directly on <code>Stopwatch</code>/system time, not an abstraction.</li>
</ul>
<p>This setup is fine for demos, but teams often need:
- Consistent correlation IDs across logs, results, and HTTP responses.
- Provider-agnostic logging contracts so Application layer code and behaviors don’t depend on MEL.
- In-memory/no-op loggers for tests and quiet scenarios.
- Structured properties without coupling to a specific logger’s API.</p>
<h2 id="what-the-core-logging-abstractions-add">What the Core logging abstractions add<a class="headerlink" href="#what-the-core-logging-abstractions-add" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Interfaces, not providers:</strong> <code>IAppLogger&lt;T&gt;</code> mirrors common log levels but stays provider-neutral. <code>ILogContext</code> stores correlation ID and exposes <code>PushProperty</code> for scoped properties.</li>
<li><strong>Implementations for tests/quiet runs:</strong> <code>InMemoryAppLogger&lt;T&gt;</code> captures entries with correlation and properties; <code>NoOpAppLogger&lt;T&gt;</code> discards logs. <code>InMemoryLogContext</code> stores properties in-memory with scoped push/pop; <code>NoOpLogContext</code> is a no-op scope holder.</li>
<li><strong>Structured entries:</strong> <code>LogEntry</code> record captures <code>Timestamp</code>, <code>Level</code>, <code>Message</code>, <code>CorrelationId</code>, optional <code>Exception</code>, and optional <code>Properties</code>.</li>
<li><strong>Integration with behaviors:</strong> Core pipeline behaviors depend on these abstractions, letting you plug in your provider with a small adapter.</li>
<li><strong>Correlation-first:</strong> <code>ILogContext.CorrelationId</code> is the single place for correlation used by behaviors; you can set it from HTTP headers or allow <code>CorrelationBehavior</code> to generate it.</li>
</ul>
<h2 id="api-surface">API surface<a class="headerlink" href="#api-surface" title="Permanent link">&para;</a></h2>
<p>Namespace: <code>CleanArchitecture.Extensions.Core.Logging</code></p>
<ul>
<li><code>IAppLogger&lt;T&gt;</code> with <code>Log(LogLevel level, string message, Exception? exception = null, IReadOnlyDictionary&lt;string, object?&gt;? properties = null)</code> plus convenience methods <code>Trace/Debug/Info/Warn/Error/Critical</code>.</li>
<li><code>ILogContext</code> with <code>string? CorrelationId { get; set; }</code> and <code>IDisposable PushProperty(string name, object? value)</code>.</li>
<li>Implementations:</li>
<li><code>InMemoryAppLogger&lt;T&gt;</code> (stores entries thread-safely).</li>
<li><code>NoOpAppLogger&lt;T&gt;</code> (ignores logs).</li>
<li><code>InMemoryLogContext</code> (stores correlation ID + properties; supports scoped push/pop).</li>
<li><code>NoOpLogContext</code> (does nothing; safe stub).</li>
<li>Supporting types:</li>
<li><code>LogEntry</code> record (timestamp, level, message, correlation ID, exception, properties).</li>
<li><code>LogLevel</code> enum (Trace, Debug, Information, Warning, Error, Critical, None).</li>
</ul>
<h2 id="why-this-matters-for-clean-architecture">Why this matters for Clean Architecture<a class="headerlink" href="#why-this-matters-for-clean-architecture" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Layer isolation:</strong> Application layer doesn’t depend on MEL/Serilog; Infrastructure can choose the provider and supply adapters. Tests run without heavy logging dependencies.</li>
<li><strong>Correlation consistency:</strong> Behaviors ensure correlation IDs reach logs; handlers can propagate the same ID into Results and domain events.</li>
<li><strong>Observability readiness:</strong> Structured properties enable search and analytics (e.g., request type, elapsed time, tenant) without forcing a specific logging library.</li>
<li><strong>Testability:</strong> In-memory logger/context make assertions straightforward in unit/integration tests.</li>
</ul>
<h2 id="wiring-in-di">Wiring in DI<a class="headerlink" href="#wiring-in-di" title="Permanent link">&para;</a></h2>
<p>Minimum registration to get logging working with Core behaviors:
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">services</span><span class="p">.</span><span class="n">AddCleanArchitectureCore</span><span class="p">(</span><span class="n">options</span><span class="w"> </span><span class="o">=&gt;</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="p">{</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">CorrelationHeaderName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;X-Correlation-ID&quot;</span><span class="p">;</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="p">});</span>
</code></pre></div>
If you need a different provider, replace <code>MelAppLoggerAdapter&lt;T&gt;</code> with your adapter; <code>ILogContext</code> can also be swapped for a provider-specific scope wrapper.</p>
<h2 id="adapting-to-microsoftextensionslogging-mel">Adapting to Microsoft.Extensions.Logging (MEL)<a class="headerlink" href="#adapting-to-microsoftextensionslogging-mel" title="Permanent link">&para;</a></h2>
<p>The package now ships <code>MelAppLoggerAdapter&lt;T&gt;</code>, which pushes <code>CorrelationId</code> into an <code>ILogger&lt;T&gt;</code> scope and logs structured properties. Swap it into DI (it’s registered by default via <code>AddCleanArchitectureCore</code>) or replace it with your own adapter if you need custom enrichment.</p>
<h2 id="adapting-to-serilog">Adapting to Serilog<a class="headerlink" href="#adapting-to-serilog" title="Permanent link">&para;</a></h2>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">public</span><span class="w"> </span><span class="k">sealed</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">SerilogAppLogger</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IAppLogger</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="p">{</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">ILogger</span><span class="w"> </span><span class="n">_logger</span><span class="p">;</span><span class="w"> </span><span class="c1">// Serilog.ILogger</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">ILogContext</span><span class="w"> </span><span class="n">_context</span><span class="p">;</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">SerilogAppLogger</span><span class="p">(</span><span class="n">ILogger</span><span class="w"> </span><span class="n">logger</span><span class="p">,</span><span class="w"> </span><span class="n">ILogContext</span><span class="w"> </span><span class="n">context</span><span class="p">)</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">        </span><span class="n">_logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">logger</span><span class="p">.</span><span class="n">ForContext</span><span class="p">(</span><span class="s">&quot;SourceContext&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">).</span><span class="n">FullName</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">).</span><span class="n">Name</span><span class="p">);</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">        </span><span class="n">_context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">;</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Log</span><span class="p">(</span><span class="n">LogLevel</span><span class="w"> </span><span class="n">level</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="n">Exception</span><span class="o">?</span><span class="w"> </span><span class="n">exception</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="n">IReadOnlyDictionary</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">object?</span><span class="o">&gt;?</span><span class="w"> </span><span class="n">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">enriched</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_logger</span><span class="p">.</span><span class="n">ForContext</span><span class="p">(</span><span class="s">&quot;CorrelationId&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_context</span><span class="p">.</span><span class="n">CorrelationId</span><span class="p">);</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">properties</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Count</span><span class="p">:</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">})</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="w">            </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">kvp</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">properties</span><span class="p">)</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="w">            </span><span class="p">{</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="w">                </span><span class="n">enriched</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">enriched</span><span class="p">.</span><span class="n">ForContext</span><span class="p">(</span><span class="n">kvp</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span><span class="w"> </span><span class="n">kvp</span><span class="p">.</span><span class="n">Value</span><span class="p">,</span><span class="w"> </span><span class="n">destructureObjects</span><span class="p">:</span><span class="w"> </span><span class="k">true</span><span class="p">);</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="w">        </span><span class="n">enriched</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="n">Map</span><span class="p">(</span><span class="n">level</span><span class="p">),</span><span class="w"> </span><span class="n">exception</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">);</span>
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">Serilog</span><span class="p">.</span><span class="n">Events</span><span class="p">.</span><span class="n">LogEventLevel</span><span class="w"> </span><span class="n">Map</span><span class="p">(</span><span class="n">LogLevel</span><span class="w"> </span><span class="n">level</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="k">switch</span>
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="w">        </span><span class="n">LogLevel</span><span class="p">.</span><span class="n">Trace</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Serilog</span><span class="p">.</span><span class="n">Events</span><span class="p">.</span><span class="n">LogEventLevel</span><span class="p">.</span><span class="n">Verbose</span><span class="p">,</span>
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a><span class="w">        </span><span class="n">LogLevel</span><span class="p">.</span><span class="n">Debug</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Serilog</span><span class="p">.</span><span class="n">Events</span><span class="p">.</span><span class="n">LogEventLevel</span><span class="p">.</span><span class="n">Debug</span><span class="p">,</span>
<a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a><span class="w">        </span><span class="n">LogLevel</span><span class="p">.</span><span class="n">Information</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Serilog</span><span class="p">.</span><span class="n">Events</span><span class="p">.</span><span class="n">LogEventLevel</span><span class="p">.</span><span class="n">Information</span><span class="p">,</span>
<a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="w">        </span><span class="n">LogLevel</span><span class="p">.</span><span class="n">Warning</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Serilog</span><span class="p">.</span><span class="n">Events</span><span class="p">.</span><span class="n">LogEventLevel</span><span class="p">.</span><span class="n">Warning</span><span class="p">,</span>
<a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a><span class="w">        </span><span class="n">LogLevel</span><span class="p">.</span><span class="n">Error</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Serilog</span><span class="p">.</span><span class="n">Events</span><span class="p">.</span><span class="n">LogEventLevel</span><span class="p">.</span><span class="n">Error</span><span class="p">,</span>
<a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a><span class="w">        </span><span class="n">LogLevel</span><span class="p">.</span><span class="n">Critical</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Serilog</span><span class="p">.</span><span class="n">Events</span><span class="p">.</span><span class="n">LogEventLevel</span><span class="p">.</span><span class="n">Fatal</span><span class="p">,</span>
<a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a><span class="w">        </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Serilog</span><span class="p">.</span><span class="n">Events</span><span class="p">.</span><span class="n">LogEventLevel</span><span class="p">.</span><span class="n">Information</span>
<a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a><span class="p">}</span>
</code></pre></div>
Register with a Serilog-backed <code>ILogContext</code> (could wrap <code>LogContext.PushProperty</code> if desired).</p>
<h2 id="sample-backed-walkthrough-logging-sample">Sample-backed walkthrough (logging sample)<a class="headerlink" href="#sample-backed-walkthrough-logging-sample" title="Permanent link">&para;</a></h2>
<p>A runnable solution lives at <code>samples/CleanArchitecture.Extensions.Core.Logging.Sample</code>.</p>
<h3 id="composite-logger-that-records-forwards-to-mel">Composite logger that records + forwards to MEL<a class="headerlink" href="#composite-logger-that-records-forwards-to-mel" title="Permanent link">&para;</a></h3>
<p><code>samples/CleanArchitecture.Extensions.Core.Logging.Sample/src/Application/Common/Logging/CompositeAppLogger.cs</code>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">public</span><span class="w"> </span><span class="k">sealed</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">CompositeAppLogger</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IAppLogger</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="p">{</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Log</span><span class="p">(</span><span class="n">LogLevel</span><span class="w"> </span><span class="n">level</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="n">Exception</span><span class="o">?</span><span class="w"> </span><span class="n">exception</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="n">IReadOnlyDictionary</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">object?</span><span class="o">&gt;?</span><span class="w"> </span><span class="n">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">correlationId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_logContext</span><span class="p">.</span><span class="n">CorrelationId</span><span class="p">;</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">        </span><span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">correlationScope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_logger</span><span class="p">.</span><span class="n">BeginScope</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Dictionary</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">object?</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;CorrelationId&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">correlationId</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">        </span><span class="n">IDisposable</span><span class="o">?</span><span class="w"> </span><span class="n">propsScope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">properties</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Count</span><span class="p">:</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">})</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">            </span><span class="n">propsScope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_logger</span><span class="p">.</span><span class="n">BeginScope</span><span class="p">(</span><span class="n">properties</span><span class="p">);</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">        </span><span class="n">_logger</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="n">MapLevel</span><span class="p">(</span><span class="n">level</span><span class="p">),</span><span class="w"> </span><span class="n">exception</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">);</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">        </span><span class="n">propsScope</span><span class="o">?.</span><span class="n">Dispose</span><span class="p">();</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="w">        </span><span class="n">_recorder</span><span class="p">.</span><span class="n">Record</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">LogEntry</span><span class="p">(</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="w">            </span><span class="n">DateTimeOffset</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">,</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="w">            </span><span class="n">level</span><span class="p">,</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="w">            </span><span class="n">message</span><span class="p">,</span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="w">            </span><span class="n">correlationId</span><span class="p">,</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="w">            </span><span class="n">exception</span><span class="p">,</span>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="w">            </span><span class="n">properties</span><span class="p">));</span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a><span class="p">}</span>
</code></pre></div>
- Logs flow to <code>ILogger&lt;T&gt;</code> scopes with correlation and are also stored in-memory via <code>ILogRecorder</code> for diagnostics.</p>
<h3 id="correlation-middleware-diagnostics-endpoints">Correlation middleware + diagnostics endpoints<a class="headerlink" href="#correlation-middleware-diagnostics-endpoints" title="Permanent link">&para;</a></h3>
<p><code>samples/CleanArchitecture.Extensions.Core.Logging.Sample/src/Web/Infrastructure/CorrelationMiddleware.cs</code> ensures every request has a correlation ID and pushes it into <code>ILogContext</code>.</p>
<p><code>samples/CleanArchitecture.Extensions.Core.Logging.Sample/src/Application/Diagnostics/Commands/EmitLogPulse/EmitLogPulseCommand.cs</code> shows emitting structured logs with correlation and optional warning/error entries:
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">correlationId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_logContext</span><span class="p">.</span><span class="n">CorrelationId</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="n">Guid</span><span class="p">.</span><span class="n">NewGuid</span><span class="p">().</span><span class="n">ToString</span><span class="p">(</span><span class="s">&quot;N&quot;</span><span class="p">);</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">_logContext</span><span class="p">.</span><span class="n">CorrelationId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">correlationId</span><span class="p">;</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">featureScope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_logContext</span><span class="p">.</span><span class="n">PushProperty</span><span class="p">(</span><span class="s">&quot;Feature&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;LoggingSample&quot;</span><span class="p">);</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="n">_logger</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="n">LogLevel</span><span class="p">.</span><span class="n">Information</span><span class="p">,</span><span class="w"> </span><span class="s">$&quot;Received log pulse: {request.Message ?? &quot;</span><span class="p">(</span><span class="n">no</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="s">&quot;}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">properties</span><span class="p">:</span><span class="w"> </span><span class="n">properties</span><span class="p">);</span>
</code></pre></div>
<code>GET /api/Diagnostics/logs</code> (see <code>.../Endpoints/Diagnostics.cs</code>) returns recent <code>LogEntry</code> items recorded by the in-memory recorder so you can see correlation + structured properties end-to-end.</p>
<h2 id="correlation-flows">Correlation flows<a class="headerlink" href="#correlation-flows" title="Permanent link">&para;</a></h2>
<ul>
<li><code>CorrelationBehavior</code> sets <code>ILogContext.CorrelationId</code> early in the pipeline.</li>
<li><code>LoggingBehavior</code> uses <code>ILogContext</code> to push <code>CorrelationId</code> into scopes.</li>
<li><code>PerformanceBehavior</code> includes <code>CorrelationId</code> in structured properties.</li>
<li>Handlers can propagate <code>_logContext.CorrelationId</code> into <code>Result.TraceId</code> or <code>DomainEvent.CorrelationId</code>.</li>
<li>HTTP middleware can set <code>ILogContext.CorrelationId</code> from <code>CoreExtensionsOptions.CorrelationHeaderName</code> and echo it back to clients.</li>
</ul>
<p>Example middleware:
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">CorrelationMiddleware</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="p">{</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">RequestDelegate</span><span class="w"> </span><span class="n">_next</span><span class="p">;</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">ILogContext</span><span class="w"> </span><span class="n">_context</span><span class="p">;</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">CoreExtensionsOptions</span><span class="w"> </span><span class="n">_options</span><span class="p">;</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">CorrelationMiddleware</span><span class="p">(</span><span class="n">RequestDelegate</span><span class="w"> </span><span class="n">next</span><span class="p">,</span><span class="w"> </span><span class="n">ILogContext</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">IOptions</span><span class="o">&lt;</span><span class="n">CoreExtensionsOptions</span><span class="o">&gt;</span><span class="w"> </span><span class="n">options</span><span class="p">)</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">        </span><span class="n">_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next</span><span class="p">;</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">        </span><span class="n">_context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">;</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">        </span><span class="n">_options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">options</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="nf">Invoke</span><span class="p">(</span><span class="n">HttpContext</span><span class="w"> </span><span class="n">http</span><span class="p">)</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_options</span><span class="p">.</span><span class="n">CorrelationHeaderName</span><span class="p">;</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">incoming</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">http</span><span class="p">.</span><span class="n">Request</span><span class="p">.</span><span class="n">Headers</span><span class="p">[</span><span class="n">header</span><span class="p">].</span><span class="n">FirstOrDefault</span><span class="p">();</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="w">        </span><span class="n">_context</span><span class="p">.</span><span class="n">CorrelationId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrWhiteSpace</span><span class="p">(</span><span class="n">incoming</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">_options</span><span class="p">.</span><span class="n">CorrelationIdFactory</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">incoming</span><span class="p">;</span>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="w">        </span><span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">scope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_context</span><span class="p">.</span><span class="n">PushProperty</span><span class="p">(</span><span class="s">&quot;CorrelationId&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_context</span><span class="p">.</span><span class="n">CorrelationId</span><span class="p">);</span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="w">        </span><span class="n">http</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="n">Headers</span><span class="p">[</span><span class="n">header</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_context</span><span class="p">.</span><span class="n">CorrelationId</span><span class="o">!</span><span class="p">;</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nf">_next</span><span class="p">(</span><span class="n">http</span><span class="p">);</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="p">}</span>
</code></pre></div></p>
<h2 id="using-inmemoryapplogger-in-tests">Using InMemoryAppLogger in tests<a class="headerlink" href="#using-inmemoryapplogger-in-tests" title="Permanent link">&para;</a></h2>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="na">[Fact]</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="k">public</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="nf">LoggingBehavior_WritesStartAndEnd_WithCorrelation</span><span class="p">()</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="p">{</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">clock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FrozenClock</span><span class="p">(</span><span class="n">DateTimeOffset</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="s">&quot;2025-01-01T00:00:00Z&quot;</span><span class="p">));</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InMemoryLogContext</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">CorrelationId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;corr-123&quot;</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InMemoryAppLogger</span><span class="o">&lt;</span><span class="n">TestRequest</span><span class="o">&gt;</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Microsoft</span><span class="p">.</span><span class="n">Extensions</span><span class="p">.</span><span class="n">Options</span><span class="p">.</span><span class="n">Options</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">CoreExtensionsOptions</span><span class="p">());</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">behavior</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingBehavior</span><span class="o">&lt;</span><span class="n">TestRequest</span><span class="p">,</span><span class="w"> </span><span class="n">Unit</span><span class="o">&gt;</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">clock</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p">);</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="n">behavior</span><span class="p">.</span><span class="n">Handle</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">TestRequest</span><span class="p">(),</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Task</span><span class="p">.</span><span class="n">FromResult</span><span class="p">(</span><span class="n">Unit</span><span class="p">.</span><span class="n">Value</span><span class="p">),</span><span class="w"> </span><span class="n">CancellationToken</span><span class="p">.</span><span class="n">None</span><span class="p">);</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="n">Entries</span><span class="p">.</span><span class="n">Should</span><span class="p">().</span><span class="n">Contain</span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="s">&quot;Handling&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">CorrelationId</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;corr-123&quot;</span><span class="p">);</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="n">Entries</span><span class="p">.</span><span class="n">Should</span><span class="p">().</span><span class="n">Contain</span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="s">&quot;Handled&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">CorrelationId</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;corr-123&quot;</span><span class="p">);</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="p">}</span>
</code></pre></div>
- <code>InMemoryAppLogger</code> captures correlation automatically from <code>ILogContext</code>.</p>
<h2 id="handling-exceptions-and-errors">Handling exceptions and errors<a class="headerlink" href="#handling-exceptions-and-errors" title="Permanent link">&para;</a></h2>
<ul>
<li>Behaviors don’t automatically log exceptions; <code>UnhandledExceptionBehaviour</code> (template) still does that with <code>ILogger&lt;T&gt;</code>. You can adapt it to <code>IAppLogger&lt;T&gt;</code> or register a global exception middleware that logs via your adapter.</li>
<li>You can log <code>Result</code> failures explicitly in handlers:
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">IsFailure</span><span class="p">)</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="p">{</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span><span class="n">_logger</span><span class="p">.</span><span class="n">Warn</span><span class="p">(</span><span class="s">&quot;Use case failed&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Dictionary</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">object?</span><span class="o">&gt;</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">        </span><span class="na">[&quot;Errors&quot;]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">Errors</span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">Code</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">TraceId</span><span class="w"> </span><span class="p">}),</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">        </span><span class="na">[&quot;CorrelationId&quot;]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">TraceId</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="n">_logContext</span><span class="p">.</span><span class="n">CorrelationId</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">    </span><span class="p">});</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="p">}</span>
</code></pre></div></li>
</ul>
<h2 id="properties-and-scopes">Properties and scopes<a class="headerlink" href="#properties-and-scopes" title="Permanent link">&para;</a></h2>
<ul>
<li><code>ILogContext.PushProperty</code> returns an <code>IDisposable</code> scope; use <code>using</code> statements to ensure pop happens even on exceptions.</li>
<li><code>InMemoryLogContext</code> keeps a dictionary of properties; it’s primarily for tests/diagnostics. For production, adapt to your logger’s native scope API (<code>BeginScope</code>, <code>LogContext.PushProperty</code>, etc.).</li>
<li><code>NoOpLogContext</code> is safe for scenarios where you don’t care about correlation or scopes (e.g., simple console apps).</li>
</ul>
<h2 id="configuration-touchpoints">Configuration touchpoints<a class="headerlink" href="#configuration-touchpoints" title="Permanent link">&para;</a></h2>
<p>Logging abstractions themselves aren’t configured via <code>CoreExtensionsOptions</code>, but they participate in options used by pipeline behaviors:
- <code>CoreExtensionsOptions.CorrelationHeaderName</code> and <code>CorrelationIdFactory</code> affect correlation handling.
- <code>CoreExtensionsOptions.EnablePerformanceLogging</code> and <code>PerformanceWarningThreshold</code> influence <code>PerformanceBehavior</code> logs.
Set these in <code>appsettings</code> under <code>Extensions:Core</code>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="p">{</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">  </span><span class="nt">&quot;Extensions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span><span class="nt">&quot;Core&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">      </span><span class="nt">&quot;CorrelationHeaderName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;X-Correlation-ID&quot;</span><span class="p">,</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">      </span><span class="nt">&quot;EnablePerformanceLogging&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">      </span><span class="nt">&quot;PerformanceWarningThreshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;00:00:00.500&quot;</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="p">}</span>
</code></pre></div></p>
<h2 id="real-world-patterns">Real-world patterns<a class="headerlink" href="#real-world-patterns" title="Permanent link">&para;</a></h2>
<h3 id="enriching-logs-with-usertenant-without-coupling-handlers">Enriching logs with user/tenant without coupling handlers<a class="headerlink" href="#enriching-logs-with-usertenant-without-coupling-handlers" title="Permanent link">&para;</a></h3>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">public</span><span class="w"> </span><span class="k">sealed</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">UserAwareLoggerAdapter</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IAppLogger</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="p">{</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">IAppLogger</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">_inner</span><span class="p">;</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">ICurrentUser</span><span class="w"> </span><span class="n">_currentUser</span><span class="p">;</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">UserAwareLoggerAdapter</span><span class="p">(</span><span class="n">IAppLogger</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">inner</span><span class="p">,</span><span class="w"> </span><span class="n">ICurrentUser</span><span class="w"> </span><span class="n">currentUser</span><span class="p">)</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">        </span><span class="n">_inner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inner</span><span class="p">;</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">        </span><span class="n">_currentUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currentUser</span><span class="p">;</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Log</span><span class="p">(</span><span class="n">LogLevel</span><span class="w"> </span><span class="n">level</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="n">Exception</span><span class="o">?</span><span class="w"> </span><span class="n">exception</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="n">IReadOnlyDictionary</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">object?</span><span class="o">&gt;?</span><span class="w"> </span><span class="n">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">enriched</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Dictionary</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">object?</span><span class="o">&gt;</span><span class="p">(</span><span class="n">properties</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Dictionary</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">object?</span><span class="o">&gt;</span><span class="p">())</span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="w">            </span><span class="na">[&quot;UserId&quot;]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_currentUser</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="w">            </span><span class="na">[&quot;UserName&quot;]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_currentUser</span><span class="p">.</span><span class="n">UserName</span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="w">        </span><span class="p">};</span>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="w">        </span><span class="n">_inner</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="n">level</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="n">exception</span><span class="p">,</span><span class="w"> </span><span class="n">enriched</span><span class="p">);</span>
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="p">}</span>
</code></pre></div>
- Register <code>UserAwareLoggerAdapter&lt;T&gt;</code> as a decorator over your provider adapter.</p>
<h3 id="logging-domain-events-with-correlation">Logging domain events with correlation<a class="headerlink" href="#logging-domain-events-with-correlation" title="Permanent link">&para;</a></h3>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">public</span><span class="w"> </span><span class="k">sealed</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">DomainEventLoggingDispatcher</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IDomainEventDispatcher</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="p">{</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">IMediator</span><span class="w"> </span><span class="n">_mediator</span><span class="p">;</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">IAppLogger</span><span class="o">&lt;</span><span class="n">DomainEventLoggingDispatcher</span><span class="o">&gt;</span><span class="w"> </span><span class="n">_logger</span><span class="p">;</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">ILogContext</span><span class="w"> </span><span class="n">_context</span><span class="p">;</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">DomainEventLoggingDispatcher</span><span class="p">(</span><span class="n">IMediator</span><span class="w"> </span><span class="n">mediator</span><span class="p">,</span><span class="w"> </span><span class="n">IAppLogger</span><span class="o">&lt;</span><span class="n">DomainEventLoggingDispatcher</span><span class="o">&gt;</span><span class="w"> </span><span class="n">logger</span><span class="p">,</span><span class="w"> </span><span class="n">ILogContext</span><span class="w"> </span><span class="n">context</span><span class="p">)</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">        </span><span class="n">_mediator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mediator</span><span class="p">;</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">        </span><span class="n">_logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">logger</span><span class="p">;</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">        </span><span class="n">_context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">;</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="nf">DispatchAsync</span><span class="p">(</span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">events</span><span class="p">,</span><span class="w"> </span><span class="n">CancellationToken</span><span class="w"> </span><span class="n">cancellationToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">)</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">events</span><span class="p">)</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="w">            </span><span class="n">_logger</span><span class="p">.</span><span class="n">Info</span><span class="p">(</span><span class="s">&quot;Publishing domain event&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Dictionary</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">object?</span><span class="o">&gt;</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="w">            </span><span class="p">{</span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="w">                </span><span class="na">[&quot;EventType&quot;]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">,</span>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="w">                </span><span class="na">[&quot;CorrelationId&quot;]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">CorrelationId</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="n">_context</span><span class="p">.</span><span class="n">CorrelationId</span>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="w">            </span><span class="p">});</span>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="w">            </span><span class="k">await</span><span class="w"> </span><span class="n">_mediator</span><span class="p">.</span><span class="n">Publish</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">cancellationToken</span><span class="p">);</span>
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a><span class="p">}</span>
</code></pre></div>
- Correlation flows from <code>ILogContext</code> to domain events, keeping observability aligned.</p>
<h3 id="quiet-mode-for-tests-or-local-dev">Quiet mode for tests or local dev<a class="headerlink" href="#quiet-mode-for-tests-or-local-dev" title="Permanent link">&para;</a></h3>
<ul>
<li>Use <code>NoOpAppLogger&lt;T&gt;</code> and <code>NoOpLogContext</code> to suppress logs entirely.</li>
<li>Switch to <code>InMemoryAppLogger</code> when you want to assert on log emission without external sinks.</li>
</ul>
<h2 id="migration-guidance-from-the-template">Migration guidance from the template<a class="headerlink" href="#migration-guidance-from-the-template" title="Permanent link">&para;</a></h2>
<ul>
<li>Keep using MEL/Serilog in Infrastructure, but inject adapters for <code>IAppLogger&lt;T&gt;</code> and <code>ILogContext</code>.</li>
<li>Replace usages of <code>ILogger&lt;T&gt;</code> in new behaviors with <code>IAppLogger&lt;T&gt;</code> to avoid leaking provider dependencies into Application layer. Existing behaviors from the template can stay until you swap them for Core equivalents.</li>
<li>In controllers or middleware, if you rely on <code>ILogger</code>, you can still do so; <code>IAppLogger</code> is primarily for Application layer and behaviors.</li>
</ul>
<h2 id="testing-tips">Testing tips<a class="headerlink" href="#testing-tips" title="Permanent link">&para;</a></h2>
<ul>
<li>With <code>InMemoryAppLogger</code>, assert:</li>
<li><code>Entries.Count</code> for expected log count.</li>
<li><code>Entries.Any(e =&gt; e.Level == LogLevel.Warning &amp;&amp; e.Message.Contains("Long running"))</code>.</li>
<li><code>CorrelationId</code> presence matches <code>ILogContext.CorrelationId</code>.</li>
<li>Use <code>FrozenClock</code> to make time-based properties deterministic when your adapter adds timestamps.</li>
<li>When testing correlation middleware + behaviors end-to-end, set <code>ILogContext.CorrelationId</code> in middleware and ensure behavior logs carry the same value.</li>
</ul>
<h2 id="faq">FAQ<a class="headerlink" href="#faq" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Do I have to abandon <code>ILogger</code>?</strong> No. Use adapters so Application code stays on <code>IAppLogger</code>; Infrastructure can still be MEL/Serilog. Existing <code>ILogger</code> usages in Web/Infrastructure remain valid.</li>
<li><strong>Where should I store correlation ID?</strong> In <code>ILogContext.CorrelationId</code>. Set it from middleware or let <code>CorrelationBehavior</code> generate it. Adapters should read it when creating scopes.</li>
<li><strong>Can I add scopes besides correlation?</strong> Yes—<code>PushProperty</code> is generic. Add tenant ID, user ID, feature flag states, etc. Ensure sensitive data policies are followed.</li>
<li><strong>What about OpenTelemetry?</strong> Bridge <code>CorrelationId</code> to trace/span IDs in your adapter or middleware. The Core abstractions avoid a hard dependency on OTEL packages.</li>
<li><strong>Do the abstractions log JSON automatically?</strong> No. Serialization is handled by your provider. Properties are provided as structured objects; your adapter decides how to render them.</li>
</ul>
<h2 id="adoption-checklist">Adoption checklist<a class="headerlink" href="#adoption-checklist" title="Permanent link">&para;</a></h2>
<p>1) Register <code>ILogContext</code> and <code>IAppLogger&lt;T&gt;</code> implementations (NoOp/InMemory or provider adapters).
2) Ensure <code>CorrelationBehavior</code> and <code>LoggingBehavior</code> are registered so correlation and lifecycle logs flow.
3) Add middleware (optional) to source correlation IDs from incoming requests.
4) Decorate your logger adapter if you need user/tenant enrichment.
5) For tests, swap <code>IAppLogger&lt;T&gt;</code> with <code>InMemoryAppLogger&lt;T&gt;</code> and assert on <code>LogEntry</code> data.
6) Gradually replace direct <code>ILogger</code> usage in new Application components with <code>IAppLogger</code> to keep the Application layer decoupled from provider specifics.</p>
<h2 id="related-docs">Related docs<a class="headerlink" href="#related-docs" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="../core-pipeline-behaviors/">Core pipeline behaviors</a> for correlation/logging/performance behaviors that consume these abstractions.</li>
<li><a href="../core-result-primitives/">Core result primitives</a> to see how trace IDs in results/errors align with correlation IDs in logs.</li>
<li><a href="../core-guard-clauses/">Core guard clauses</a> for guards that emit errors you might log with correlation.</li>
<li><a href="../core/">Core extension overview</a> for the big-picture view and registration guidance.</li>
</ul>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">December 8, 2025</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.tracking", "content.code.copy", "content.tabs.link", "search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8d2eff1.min.js"></script>
      
    
  </body>
</html>