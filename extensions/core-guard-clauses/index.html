
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Extensions ecosystem for Jason Taylor's Clean Architecture template.">
      
      
      
        <link rel="canonical" href="https://cleanarchitecture-extensions.github.io/CleanArchitecture.Extensions/extensions/core-guard-clauses/">
      
      
        <link rel="prev" href="../core-pipeline-behaviors/">
      
      
        <link rel="next" href="../core-result-primitives/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.13">
    
    
      
        <title>Core Guard Clauses - CleanArchitecture.Extensions</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e359304.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#core-guard-clauses" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="CleanArchitecture.Extensions" class="md-header__button md-logo" aria-label="CleanArchitecture.Extensions" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CleanArchitecture.Extensions
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Core Guard Clauses
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/CleanArchitecture-Extensions/CleanArchitecture.Extensions" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    CleanArchitecture-Extensions/CleanArchitecture.Extensions
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../roadmap/" class="md-tabs__link">
        
  
    
  
  Roadmap

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../getting-started/quickstart/" class="md-tabs__link">
          
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../concepts/architecture-fit/" class="md-tabs__link">
          
  
  Concepts

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  Extensions Catalog

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../recipes/authentication/" class="md-tabs__link">
          
  
  Recipes

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../samples/" class="md-tabs__link">
        
  
    
  
  Samples

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../reference/configuration/" class="md-tabs__link">
        
  
    
  
  Reference

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../troubleshooting/" class="md-tabs__link">
        
  
    
  
  Troubleshooting

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../contributing/" class="md-tabs__link">
        
  
    
  
  Contributing

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../release-notes/" class="md-tabs__link">
        
  
    
  
  Release Notes

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="CleanArchitecture.Extensions" class="md-nav__button md-logo" aria-label="CleanArchitecture.Extensions" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    CleanArchitecture.Extensions
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/CleanArchitecture-Extensions/CleanArchitecture.Extensions" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    CleanArchitecture-Extensions/CleanArchitecture.Extensions
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../roadmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Roadmap
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/quickstart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quickstart
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Concepts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/architecture-fit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture Fit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/composition/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Composition & Invariants
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Extensions Catalog
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Extensions Catalog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core-options/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core Options
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core-time/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core Time
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core-domain-events/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core Domain Events
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core-logging-abstractions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core Logging Abstractions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core-pipeline-behaviors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core Pipeline Behaviors
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Core Guard Clauses
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Core Guard Clauses
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-the-template-already-covers" class="md-nav__link">
    <span class="md-ellipsis">
      What the template already covers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-use-core-guard-clauses" class="md-nav__link">
    <span class="md-ellipsis">
      Why use Core guard clauses
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-surface" class="md-nav__link">
    <span class="md-ellipsis">
      API surface
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#strategy-modes-explained" class="md-nav__link">
    <span class="md-ellipsis">
      Strategy modes explained
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comparing-to-template-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Comparing to template validation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation-refresher" class="md-nav__link">
    <span class="md-ellipsis">
      Installation refresher
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-start-examples-backed-by-the-guard-sample" class="md-nav__link">
    <span class="md-ellipsis">
      Quick-start examples (backed by the guard sample)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Quick-start examples (backed by the guard sample)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#short-circuit-on-first-failure-returnfailure" class="md-nav__link">
    <span class="md-ellipsis">
      Short-circuit on first failure (ReturnFailure)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#accumulate-multiple-failures-batch-import" class="md-nav__link">
    <span class="md-ellipsis">
      Accumulate multiple failures (batch import)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#throwing-for-exception-first-pipelines" class="md-nav__link">
    <span class="md-ellipsis">
      Throwing for exception-first pipelines
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detailed-guard-behaviors" class="md-nav__link">
    <span class="md-ellipsis">
      Detailed guard behaviors
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#composition-with-result-helpers" class="md-nav__link">
    <span class="md-ellipsis">
      Composition with Result helpers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-guards-in-domain-entities" class="md-nav__link">
    <span class="md-ellipsis">
      Using guards in domain entities
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integrating-with-mediatr-pipelines" class="md-nav__link">
    <span class="md-ellipsis">
      Integrating with MediatR pipelines
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#working-with-fluentvalidation" class="md-nav__link">
    <span class="md-ellipsis">
      Working with FluentValidation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-via-coreextensionsoptions" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration via CoreExtensionsOptions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-accumulation-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Error accumulation patterns
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#httpapi-translation" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP/API translation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-guards" class="md-nav__link">
    <span class="md-ellipsis">
      Testing guards
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Performance considerations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extending-guards" class="md-nav__link">
    <span class="md-ellipsis">
      Extending guards
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adoption-playbook" class="md-nav__link">
    <span class="md-ellipsis">
      Adoption playbook
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reference-methods-and-codes" class="md-nav__link">
    <span class="md-ellipsis">
      Reference: Methods and codes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related-docs" class="md-nav__link">
    <span class="md-ellipsis">
      Related docs
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core-result-primitives/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core Result Primitives
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../validation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Validation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multitenancy-core/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multitenancy Core
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Recipes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Recipes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recipes/authentication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recipes/caching/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Caching
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Samples
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reference
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshooting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Release Notes
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-the-template-already-covers" class="md-nav__link">
    <span class="md-ellipsis">
      What the template already covers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-use-core-guard-clauses" class="md-nav__link">
    <span class="md-ellipsis">
      Why use Core guard clauses
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-surface" class="md-nav__link">
    <span class="md-ellipsis">
      API surface
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#strategy-modes-explained" class="md-nav__link">
    <span class="md-ellipsis">
      Strategy modes explained
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comparing-to-template-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Comparing to template validation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation-refresher" class="md-nav__link">
    <span class="md-ellipsis">
      Installation refresher
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-start-examples-backed-by-the-guard-sample" class="md-nav__link">
    <span class="md-ellipsis">
      Quick-start examples (backed by the guard sample)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Quick-start examples (backed by the guard sample)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#short-circuit-on-first-failure-returnfailure" class="md-nav__link">
    <span class="md-ellipsis">
      Short-circuit on first failure (ReturnFailure)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#accumulate-multiple-failures-batch-import" class="md-nav__link">
    <span class="md-ellipsis">
      Accumulate multiple failures (batch import)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#throwing-for-exception-first-pipelines" class="md-nav__link">
    <span class="md-ellipsis">
      Throwing for exception-first pipelines
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detailed-guard-behaviors" class="md-nav__link">
    <span class="md-ellipsis">
      Detailed guard behaviors
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#composition-with-result-helpers" class="md-nav__link">
    <span class="md-ellipsis">
      Composition with Result helpers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-guards-in-domain-entities" class="md-nav__link">
    <span class="md-ellipsis">
      Using guards in domain entities
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integrating-with-mediatr-pipelines" class="md-nav__link">
    <span class="md-ellipsis">
      Integrating with MediatR pipelines
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#working-with-fluentvalidation" class="md-nav__link">
    <span class="md-ellipsis">
      Working with FluentValidation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-via-coreextensionsoptions" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration via CoreExtensionsOptions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-accumulation-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Error accumulation patterns
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#httpapi-translation" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP/API translation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-guards" class="md-nav__link">
    <span class="md-ellipsis">
      Testing guards
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Performance considerations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extending-guards" class="md-nav__link">
    <span class="md-ellipsis">
      Extending guards
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adoption-playbook" class="md-nav__link">
    <span class="md-ellipsis">
      Adoption playbook
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reference-methods-and-codes" class="md-nav__link">
    <span class="md-ellipsis">
      Reference: Methods and codes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related-docs" class="md-nav__link">
    <span class="md-ellipsis">
      Related docs
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="core-guard-clauses">Core Guard Clauses<a class="headerlink" href="#core-guard-clauses" title="Permanent link">&para;</a></h1>
<p>Guard clauses in the Core extension give you a consistent, testable way to enforce invariants without scattering <code>if/throw</code> statements across handlers and entities. They pair with the extension’s <code>Result</code> primitives so you can choose return-based validation (preferred for application flows) or exception-based validation (when you rely on middleware). This page explains how the Clean Architecture template handles validation today, why the extension adds more flexible guards, and how to integrate them with pipelines, Results, and domain logic.</p>
<h2 id="what-the-template-already-covers">What the template already covers<a class="headerlink" href="#what-the-template-already-covers" title="Permanent link">&para;</a></h2>
<p>Jason Taylor’s template leans on two mechanisms:</p>
<ul>
<li><strong>FluentValidation + MediatR ValidationBehaviour:</strong> Validators throw <code>ValidationException</code> when rules fail. Controllers/middleware translate those exceptions into ProblemDetails responses.</li>
<li><strong>Ad hoc checks:</strong> Handlers and services sometimes do simple <code>if (string.IsNullOrWhiteSpace(...)) throw ...;</code> for quick guards. There is no common error shape or trace propagation.</li>
<li><strong>Result type is minimal:</strong> The template’s <code>Result</code> is <code>Succeeded + string[] Errors</code> and is mainly used in Identity flows; it does not pair with guard outcomes elsewhere.</li>
</ul>
<p>This works for demos but makes it harder to:</p>
<ul>
<li>Return structured errors without throwing.</li>
<li>Accumulate multiple guard failures for richer UX.</li>
<li>Keep correlation/trace IDs attached to validation failures.</li>
<li>Reuse guard logic in domain entities without bringing FluentValidation into the domain layer.</li>
</ul>
<h2 id="why-use-core-guard-clauses">Why use Core guard clauses<a class="headerlink" href="#why-use-core-guard-clauses" title="Permanent link">&para;</a></h2>
<p>The Core package introduces a focused guard library that aligns with the template’s MediatR wiring while keeping your domain/application code technology-agnostic:</p>
<ul>
<li><strong>Strategy-driven:</strong> Choose per-call whether to return <code>Result</code> failures (<code>ReturnFailure</code>), throw (<code>Throw</code>), or accumulate errors (<code>Accumulate</code>) into a shared sink.</li>
<li><strong>Trace-friendly:</strong> Guards accept <code>GuardOptions.TraceId</code>; failures propagate trace IDs into <code>Error</code> instances, staying aligned with correlation behaviors.</li>
<li><strong>Result-native:</strong> Guards produce <code>Result&lt;T&gt;</code> (or <code>Result</code>) so you can compose with <code>Map/Bind/Combine</code> instead of relying on exceptions.</li>
<li><strong>Domain-ready:</strong> No FluentValidation dependency; the API is simple enough to use inside aggregates while keeping error metadata consistent with the application layer.</li>
<li><strong>Batch-aware:</strong> <code>Accumulate</code> lets you gather multiple failures (e.g., CSV import) and report them together.</li>
</ul>
<h2 id="api-surface">API surface<a class="headerlink" href="#api-surface" title="Permanent link">&para;</a></h2>
<p>Namespace: <code>CleanArchitecture.Extensions.Core.Guards</code></p>
<p>Guards:</p>
<ul>
<li><code>AgainstNull&lt;T&gt;(value, parameterName, options?)</code></li>
<li><code>AgainstNullOrWhiteSpace(string?, parameterName, options?)</code></li>
<li><code>AgainstOutOfRange&lt;T&gt;(value, min, max, parameterName, options?) where T : IComparable&lt;T&gt;</code></li>
<li><code>AgainstUndefinedEnum&lt;TEnum&gt;(value, parameterName, options?) where TEnum : struct, Enum</code></li>
<li><code>AgainstTooShort(string value, minLength, parameterName, options?)</code></li>
<li><code>AgainstTooLong(string value, maxLength, parameterName, options?)</code></li>
<li><code>Ensure(bool condition, code, message, options?)</code></li>
</ul>
<p>Support types:</p>
<ul>
<li><code>GuardOptions</code> (strategy, error sink, exception factory, trace ID; plus <code>FromOptions(CoreExtensionsOptions, errorSink?)</code>).</li>
<li><code>GuardStrategy</code> (<code>ReturnFailure</code>, <code>Throw</code>, <code>Accumulate</code>).</li>
</ul>
<p>Outputs:</p>
<ul>
<li><code>Result&lt;T&gt;</code> or <code>Result</code> from the Core Result primitives, carrying <code>Error</code> objects with <code>Code</code>, <code>Message</code>, <code>TraceId</code>.</li>
</ul>
<h2 id="strategy-modes-explained">Strategy modes explained<a class="headerlink" href="#strategy-modes-explained" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>ReturnFailure (default):</strong> Guards return <code>Result</code>/<code>Result&lt;T&gt;</code> failures. Handlers can short-circuit or combine errors. No exceptions are thrown.</li>
<li><strong>Throw:</strong> Guards throw immediately. If you prefer exception-driven flows (e.g., existing middleware for 400s), set <code>GuardOptions.Strategy = GuardStrategy.Throw</code> or configure <code>CoreExtensionsOptions.GuardStrategy</code>.</li>
<li><strong>Accumulate:</strong> Guard errors are added to an <code>ICollection&lt;Error&gt;</code> sink (provided via <code>GuardOptions.ErrorSink</code>), and a failure <code>Result</code> is returned. Use this for batch operations where you want to report all issues at once.</li>
</ul>
<p><code>ExceptionFactory</code> lets you shape exceptions when <code>Throw</code> is selected (e.g., custom domain exceptions).</p>
<h2 id="comparing-to-template-validation">Comparing to template validation<a class="headerlink" href="#comparing-to-template-validation" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>FluentValidation Behaviour:</strong> Runs after <code>AuthorizationBehaviour</code> and before <code>PerformanceBehaviour</code>. Throws <code>ValidationException</code> on first validation failure batch.</li>
<li><strong>Core Guards:</strong> Can run inside the handler or domain entity. When configured to return failures, they avoid exceptions and keep control in the handler. You can still use FluentValidation for complex cross-field rules while using guards for fast, local checks.</li>
<li><strong>Blended approach:</strong> Use guards for early, cheap validations (null/length/range) and FluentValidation for business rules that benefit from rich tooling and localization. Both can coexist because guards do not change pipeline signatures.</li>
</ul>
<h2 id="installation-refresher">Installation refresher<a class="headerlink" href="#installation-refresher" title="Permanent link">&para;</a></h2>
<p>If you have not yet installed the Core extension:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>dotnet<span class="w"> </span>add<span class="w"> </span>src/YourProject/YourProject.csproj<span class="w"> </span>package<span class="w"> </span>CleanArchitecture.Extensions.Core
</code></pre></div>
<p>Register <code>CoreExtensionsOptions</code> in DI so guards can inherit defaults:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">services</span><span class="p">.</span><span class="n">Configure</span><span class="o">&lt;</span><span class="n">CoreExtensionsOptions</span><span class="o">&gt;</span><span class="p">(</span><span class="n">configuration</span><span class="p">.</span><span class="n">GetSection</span><span class="p">(</span><span class="s">&quot;Extensions:Core&quot;</span><span class="p">));</span>
</code></pre></div>
<h2 id="quick-start-examples-backed-by-the-guard-sample">Quick-start examples (backed by the guard sample)<a class="headerlink" href="#quick-start-examples-backed-by-the-guard-sample" title="Permanent link">&para;</a></h2>
<p>A runnable solution that demonstrates each strategy lives at <code>samples/CleanArchitecture.Extensions.Core.Guards.Sample</code>.</p>
<h3 id="short-circuit-on-first-failure-returnfailure">Short-circuit on first failure (ReturnFailure)<a class="headerlink" href="#short-circuit-on-first-failure-returnfailure" title="Permanent link">&para;</a></h3>
<p><code>samples/CleanArchitecture.Extensions.Core.Guards.Sample/src/Application/Projects/Commands/CreateProject/CreateProject.cs</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">traceId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Guid</span><span class="p">.</span><span class="n">NewGuid</span><span class="p">().</span><span class="n">ToString</span><span class="p">(</span><span class="s">&quot;N&quot;</span><span class="p">);</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="kt">var</span><span class="w"> </span><span class="n">guardOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CoreGuardOptions</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">TraceId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">traceId</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="kt">var</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CoreGuard</span><span class="p">.</span><span class="n">AgainstNullOrWhiteSpace</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="k">nameof</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">Name</span><span class="p">),</span><span class="w"> </span><span class="n">guardOptions</span><span class="p">)</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">    </span><span class="p">.</span><span class="n">Ensure</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">MaxNameLength</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CoreResults</span><span class="p">.</span><span class="n">Error</span><span class="p">(</span><span class="s">&quot;projects.name.length&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">$&quot;Name must be {MaxNameLength} characters or fewer.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">traceId</span><span class="p">));</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="kt">var</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrWhiteSpace</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">Description</span><span class="p">)</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">    </span><span class="o">?</span><span class="w"> </span><span class="n">CoreResults</span><span class="p">.</span><span class="n">Result</span><span class="p">.</span><span class="n">Success</span><span class="o">&lt;</span><span class="kt">string?</span><span class="o">&gt;</span><span class="p">(</span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="n">traceId</span><span class="p">)</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">    </span><span class="p">:</span><span class="w"> </span><span class="n">CoreGuard</span><span class="p">.</span><span class="n">AgainstTooLong</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">Description</span><span class="p">,</span><span class="w"> </span><span class="n">MaxDescriptionLength</span><span class="p">,</span><span class="w"> </span><span class="k">nameof</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">Description</span><span class="p">),</span><span class="w"> </span><span class="n">guardOptions</span><span class="p">)</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">        </span><span class="p">.</span><span class="n">Map</span><span class="p">(</span><span class="k">value</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="kt">string?</span><span class="p">)</span><span class="k">value</span><span class="p">.</span><span class="n">Trim</span><span class="p">(),</span><span class="w"> </span><span class="n">traceId</span><span class="p">);</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="kt">var</span><span class="w"> </span><span class="n">budget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CoreGuard</span><span class="p">.</span><span class="n">Ensure</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">Budget</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">    </span><span class="s">&quot;projects.budget.range&quot;</span><span class="p">,</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">    </span><span class="s">&quot;Budget cannot be negative.&quot;</span><span class="p">,</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">    </span><span class="n">guardOptions</span><span class="p">);</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="kt">var</span><span class="w"> </span><span class="n">validation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CoreResults</span><span class="p">.</span><span class="n">Result</span><span class="p">.</span><span class="n">Combine</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">,</span><span class="w"> </span><span class="n">budget</span><span class="p">);</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">validation</span><span class="p">.</span><span class="n">IsFailure</span><span class="p">)</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="p">{</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">CoreResults</span><span class="p">.</span><span class="n">Result</span><span class="p">.</span><span class="n">Failure</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">validation</span><span class="p">.</span><span class="n">Errors</span><span class="p">,</span><span class="w"> </span><span class="n">traceId</span><span class="p">);</span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="p">}</span>
</code></pre></div>
<ul>
<li>Guards stay branch-light until all cheap checks run, then short-circuit with a single <code>Result.Combine</code> failure.</li>
<li>The handler continues on success to check duplicates and persist, preserving the same <code>traceId</code>.</li>
</ul>
<h3 id="accumulate-multiple-failures-batch-import">Accumulate multiple failures (batch import)<a class="headerlink" href="#accumulate-multiple-failures-batch-import" title="Permanent link">&para;</a></h3>
<p><code>samples/CleanArchitecture.Extensions.Core.Guards.Sample/src/Application/Projects/Commands/ImportProjects/ImportProjects.cs</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">sink</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">CoreResults</span><span class="p">.</span><span class="n">Error</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="kt">var</span><span class="w"> </span><span class="n">guardOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CoreGuardOptions</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="p">{</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="n">Strategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GuardStrategy</span><span class="p">.</span><span class="n">Accumulate</span><span class="p">,</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span><span class="n">ErrorSink</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sink</span><span class="p">,</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">    </span><span class="n">TraceId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">traceId</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="p">};</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">incoming</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span><span class="w"> </span><span class="n">index</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="p">{</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">project</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">incoming</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">beforeCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sink</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">nameResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CoreGuard</span><span class="p">.</span><span class="n">AgainstNullOrWhiteSpace</span><span class="p">(</span><span class="n">project</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="k">nameof</span><span class="p">(</span><span class="n">project</span><span class="p">.</span><span class="n">Name</span><span class="p">),</span><span class="w"> </span><span class="n">guardOptions</span><span class="p">)</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="w">        </span><span class="p">.</span><span class="n">Ensure</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">MaxNameLength</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CoreResults</span><span class="p">.</span><span class="n">Error</span><span class="p">(</span><span class="s">&quot;projects.name.length&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">$&quot;Name must be {MaxNameLength} characters or fewer.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">traceId</span><span class="p">));</span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">budgetResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CoreGuard</span><span class="p">.</span><span class="n">Ensure</span><span class="p">(</span><span class="n">project</span><span class="p">.</span><span class="n">Budget</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;projects.budget.range&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Budget cannot be negative.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">guardOptions</span><span class="p">);</span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nameResult</span><span class="p">.</span><span class="n">IsSuccess</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">budgetResult</span><span class="p">.</span><span class="n">IsSuccess</span><span class="p">)</span>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a><span class="w">        </span><span class="n">projects</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Project</span><span class="p">(</span><span class="n">project</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">Trim</span><span class="p">(),</span><span class="w"> </span><span class="n">project</span><span class="p">.</span><span class="n">Description</span><span class="p">,</span><span class="w"> </span><span class="n">project</span><span class="p">.</span><span class="n">Budget</span><span class="p">));</span>
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a><span class="w">        </span><span class="n">AddRowMetadata</span><span class="p">(</span><span class="n">sink</span><span class="p">,</span><span class="w"> </span><span class="n">beforeCount</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a><span class="p">}</span>
<a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a>
<a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sink</span><span class="p">.</span><span class="n">Count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a><span class="p">{</span>
<a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">CoreResults</span><span class="p">.</span><span class="n">Result</span><span class="p">.</span><span class="n">Failure</span><span class="o">&lt;</span><span class="n">IReadOnlyList</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">sink</span><span class="p">,</span><span class="w"> </span><span class="n">traceId</span><span class="p">);</span>
<a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a><span class="p">}</span>
</code></pre></div>
<ul>
<li><code>GuardStrategy.Accumulate</code> keeps looping and decorates new errors with a <code>row</code> metadata entry so the client can show all issues at once.</li>
<li>Only when the sink is empty do we add the batch to the DbContext and save.</li>
</ul>
<h3 id="throwing-for-exception-first-pipelines">Throwing for exception-first pipelines<a class="headerlink" href="#throwing-for-exception-first-pipelines" title="Permanent link">&para;</a></h3>
<p><code>samples/CleanArchitecture.Extensions.Core.Guards.Sample/src/Application/Projects/Commands/ArchiveProjectWithThrow/ArchiveProjectWithThrow.cs</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">guardOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CoreGuardOptions</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="p">{</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="n">Strategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GuardStrategy</span><span class="p">.</span><span class="n">Throw</span><span class="p">,</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="n">ExceptionFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InvalidOperationException</span><span class="p">(</span><span class="s">$&quot;{error.Code}: {error.Message}&quot;</span><span class="p">)</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="p">};</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="kt">var</span><span class="w"> </span><span class="n">project</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="n">_context</span><span class="p">.</span><span class="n">Projects</span><span class="p">.</span><span class="n">FirstOrDefaultAsync</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">Id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span><span class="w"> </span><span class="n">cancellationToken</span><span class="p">);</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="n">CoreGuard</span><span class="p">.</span><span class="n">AgainstNull</span><span class="p">(</span><span class="n">project</span><span class="p">,</span><span class="w"> </span><span class="k">nameof</span><span class="p">(</span><span class="n">project</span><span class="p">),</span><span class="w"> </span><span class="n">guardOptions</span><span class="p">);</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="n">CoreGuard</span><span class="p">.</span><span class="n">Ensure</span><span class="p">(</span><span class="o">!</span><span class="n">project</span><span class="o">!</span><span class="p">.</span><span class="n">IsArchived</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;projects.archived&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Project is already archived.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">guardOptions</span><span class="p">);</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="n">project</span><span class="p">.</span><span class="n">Archive</span><span class="p">(</span><span class="n">DateTimeOffset</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">);</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="k">await</span><span class="w"> </span><span class="n">_context</span><span class="p">.</span><span class="n">SaveChangesAsync</span><span class="p">(</span><span class="n">cancellationToken</span><span class="p">);</span>
</code></pre></div>
<ul>
<li>When <code>Throw</code> is chosen, guards raise exceptions immediately. In the sample API, the endpoint catches and translates them to a 400 response to demonstrate exception-first wiring.</li>
</ul>
<h2 id="detailed-guard-behaviors">Detailed guard behaviors<a class="headerlink" href="#detailed-guard-behaviors" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Trace propagation:</strong> When <code>TraceId</code> is set in options, every guard-generated error carries it. If omitted, the guard produces errors without a trace; you can still attach a trace later when turning guard results into handler results.</li>
<li><strong>Error codes:</strong> Each guard uses a stable code:</li>
<li><code>guard.null</code></li>
<li><code>guard.empty</code></li>
<li><code>guard.range</code></li>
<li><code>guard.enum</code></li>
<li><code>guard.length</code></li>
<li>custom code for <code>Ensure</code> (you pass it).
    Use these codes for client-side localization or analytics.</li>
<li><strong>Messages:</strong> Default English messages are provided. If you need localization, wrap guards in a helper that maps codes to localized strings, or set <code>ExceptionFactory</code> to craft localized exceptions when throwing.</li>
<li><strong>Range check semantics:</strong> <code>AgainstOutOfRange</code> is inclusive (<code>minimum &lt;= value &lt;= maximum</code>). For exclusive checks, call it with adjusted bounds or add an <code>Ensure</code> with your own predicate.</li>
<li><strong>Enum checks:</strong> <code>AgainstUndefinedEnum</code> defends against undefined numeric casts or new values introduced without handler changes.</li>
<li><strong>Length checks:</strong> <code>AgainstTooShort</code> and <code>AgainstTooLong</code> operate on <code>string.Length</code>; for grapheme-aware length, add a custom guard using <code>Ensure</code>.</li>
</ul>
<h2 id="composition-with-result-helpers">Composition with Result helpers<a class="headerlink" href="#composition-with-result-helpers" title="Permanent link">&para;</a></h2>
<p>Because guards return Results, you can compose them without <code>if</code> ladders:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">public</span><span class="w"> </span><span class="n">Result</span><span class="o">&lt;</span><span class="n">CheckoutRequest</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Validate</span><span class="p">(</span><span class="n">CheckoutRequest</span><span class="w"> </span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">GuardOptions</span><span class="w"> </span><span class="n">options</span><span class="p">)</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="p">{</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Guard</span><span class="p">.</span><span class="n">AgainstNullOrWhiteSpace</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="n">CustomerId</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CustomerId&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p">)</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">        </span><span class="p">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Guard</span><span class="p">.</span><span class="n">AgainstOutOfRange</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="n">Items</span><span class="p">.</span><span class="n">Count</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Items.Count&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p">))</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">        </span><span class="p">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Guard</span><span class="p">.</span><span class="n">Ensure</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="n">Currency</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;USD&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;checkout.currency&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Only USD supported&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p">))</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">        </span><span class="p">.</span><span class="n">Map</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">input</span><span class="p">);</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="p">}</span>
</code></pre></div>
<ul>
<li><code>Bind</code> short-circuits on first failure.</li>
<li><code>Ensure</code> inserts custom predicate-based checks without new guard methods.</li>
<li><code>Map</code> wraps the validated input back into the result, preserving the trace ID.</li>
</ul>
<h2 id="using-guards-in-domain-entities">Using guards in domain entities<a class="headerlink" href="#using-guards-in-domain-entities" title="Permanent link">&para;</a></h2>
<p>Domain entities should not depend on FluentValidation. Guards give you lightweight checks while keeping errors structured:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">public</span><span class="w"> </span><span class="k">sealed</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Money</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="p">{</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Currency</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">Amount</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="nf">Money</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">currency</span><span class="p">,</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">        </span><span class="n">Currency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currency</span><span class="p">;</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">        </span><span class="n">Amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">Result</span><span class="o">&lt;</span><span class="n">Money</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Create</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">currency</span><span class="p">,</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="n">GuardOptions</span><span class="w"> </span><span class="n">options</span><span class="p">)</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Guard</span><span class="p">.</span><span class="n">AgainstNullOrWhiteSpace</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span><span class="w"> </span><span class="k">nameof</span><span class="p">(</span><span class="n">currency</span><span class="p">),</span><span class="w"> </span><span class="n">options</span><span class="p">)</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="w">            </span><span class="p">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Guard</span><span class="p">.</span><span class="n">AgainstOutOfRange</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="mf">0m</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="n">_000_000m</span><span class="p">,</span><span class="w"> </span><span class="k">nameof</span><span class="p">(</span><span class="n">amount</span><span class="p">),</span><span class="w"> </span><span class="n">options</span><span class="p">))</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="w">            </span><span class="p">.</span><span class="n">Map</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Money</span><span class="p">(</span><span class="n">currency</span><span class="p">.</span><span class="n">Trim</span><span class="p">().</span><span class="n">ToUpperInvariant</span><span class="p">(),</span><span class="w"> </span><span class="n">amount</span><span class="p">));</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="p">}</span>
</code></pre></div>
<ul>
<li>The factory returns <code>Result&lt;Money&gt;</code>; handlers can propagate failures, aggregate them, or translate them into API responses without throwing.</li>
</ul>
<h2 id="integrating-with-mediatr-pipelines">Integrating with MediatR pipelines<a class="headerlink" href="#integrating-with-mediatr-pipelines" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Ordering:</strong> Use guards inside handlers before hitting infrastructure. If you prefer middleware-level handling, set strategy to <code>Throw</code> and let <code>UnhandledExceptionBehaviour</code> or your API middleware translate exceptions.</li>
<li><strong>Correlation:</strong> Run <code>CorrelationBehavior</code> early so <code>ILogContext.CorrelationId</code> is set. Pass that ID into <code>GuardOptions.TraceId</code> to keep guard errors aligned with logs.</li>
<li><strong>PerformanceBehavior:</strong> Guards are synchronous and cheap; they do not materially affect elapsed timing unless used in tight loops on large collections (batch validation). In those cases, consider aggregating and emitting a single performance log.</li>
</ul>
<h2 id="working-with-fluentvalidation">Working with FluentValidation<a class="headerlink" href="#working-with-fluentvalidation" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Complementary roles:</strong> Use guards for fast, mechanical checks (null/length/range) and FluentValidation for richer, cross-field rules or localized error messages.</li>
<li><strong>Avoid double work:</strong> If FluentValidation already covers a rule, do not duplicate it with guards unless you want early short-circuiting before expensive operations (e.g., DB calls).</li>
<li><strong>Shared error shape:</strong> You can map <code>ValidationFailure</code> to <code>Error</code> to stay consistent with guard outputs:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">errors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">failures</span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="o">=&gt;</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="nf">Error</span><span class="p">(</span><span class="s">$&quot;validation.{f.PropertyName.ToLowerInvariant()}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">ErrorMessage</span><span class="p">,</span><span class="w"> </span><span class="n">traceId</span><span class="p">));</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="k">return</span><span class="w"> </span><span class="n">Result</span><span class="p">.</span><span class="n">Failure</span><span class="o">&lt;</span><span class="n">TResponse</span><span class="o">&gt;</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span><span class="w"> </span><span class="n">traceId</span><span class="p">);</span>
</code></pre></div>
<h2 id="configuration-via-coreextensionsoptions">Configuration via CoreExtensionsOptions<a class="headerlink" href="#configuration-via-coreextensionsoptions" title="Permanent link">&para;</a></h2>
<p><code>GuardOptions.FromOptions(CoreExtensionsOptions options, ICollection&lt;Error&gt;? errorSink = null)</code> lets you centralize defaults:</p>
<ul>
<li><code>GuardStrategy</code> (default <code>ReturnFailure</code>).</li>
<li><code>TraceId</code> default.</li>
<li>Injected <code>ErrorSink</code> when you want accumulation.
  Set <code>Extensions:Core:GuardStrategy</code> in configuration to change the default behavior across the app, then override per call as needed.</li>
</ul>
<h2 id="error-accumulation-patterns">Error accumulation patterns<a class="headerlink" href="#error-accumulation-patterns" title="Permanent link">&para;</a></h2>
<p>For scenarios where you must present all issues (e.g., admin bulk imports), combine <code>Accumulate</code> with <code>Result.Combine</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">sink</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Error</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="kt">var</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GuardOptions</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Strategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GuardStrategy</span><span class="p">.</span><span class="n">Accumulate</span><span class="p">,</span><span class="w"> </span><span class="n">ErrorSink</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sink</span><span class="p">,</span><span class="w"> </span><span class="n">TraceId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">traceId</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="n">Guard</span><span class="p">.</span><span class="n">AgainstTooShort</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;FirstName&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p">);</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="n">Guard</span><span class="p">.</span><span class="n">AgainstTooShort</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">LastName</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;LastName&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p">);</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="n">Guard</span><span class="p">.</span><span class="n">Ensure</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">Email</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="sc">&#39;@&#39;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;user.email&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Email is invalid&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p">);</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="k">return</span><span class="w"> </span><span class="n">sink</span><span class="p">.</span><span class="n">Count</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">    </span><span class="o">?</span><span class="w"> </span><span class="n">Result</span><span class="p">.</span><span class="n">Success</span><span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">TraceId</span><span class="p">)</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">    </span><span class="p">:</span><span class="w"> </span><span class="n">Result</span><span class="p">.</span><span class="n">Failure</span><span class="p">(</span><span class="n">sink</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p">.</span><span class="n">TraceId</span><span class="p">);</span>
</code></pre></div>
<ul>
<li>You can still return a single <code>Result</code> to the caller while surfacing all errors.</li>
</ul>
<h2 id="httpapi-translation">HTTP/API translation<a class="headerlink" href="#httpapi-translation" title="Permanent link">&para;</a></h2>
<p>Pair guard-produced errors with ProblemDetails:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="n">mediator</span><span class="p">.</span><span class="n">Send</span><span class="p">(</span><span class="n">command</span><span class="p">,</span><span class="w"> </span><span class="n">ct</span><span class="p">);</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">IsFailure</span><span class="p">)</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="p">{</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">problems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">Errors</span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">Code</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">TraceId</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">Metadata</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Results</span><span class="p">.</span><span class="n">Problem</span><span class="p">(</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">        </span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Validation failed&quot;</span><span class="p">,</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">        </span><span class="n">statusCode</span><span class="p">:</span><span class="w"> </span><span class="n">StatusCodes</span><span class="p">.</span><span class="n">Status400BadRequest</span><span class="p">,</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">        </span><span class="n">detail</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;One or more validation errors occurred.&quot;</span><span class="p">,</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">        </span><span class="n">extensions</span><span class="p">:</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Dictionary</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">object?</span><span class="o">&gt;</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">            </span><span class="na">[&quot;errors&quot;]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">problems</span><span class="p">,</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">            </span><span class="na">[&quot;traceId&quot;]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">TraceId</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">        </span><span class="p">});</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="p">}</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="k">return</span><span class="w"> </span><span class="n">Results</span><span class="p">.</span><span class="n">Ok</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">Value</span><span class="p">,</span><span class="w"> </span><span class="n">traceId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">TraceId</span><span class="w"> </span><span class="p">});</span>
</code></pre></div>
<ul>
<li>Clients get consistent codes/messages and a trace ID for troubleshooting.</li>
</ul>
<h2 id="testing-guards">Testing guards<a class="headerlink" href="#testing-guards" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Deterministic:</strong> Guards have no time dependency. You can assert on <code>IsSuccess</code>, <code>Errors.Count</code>, <code>Error.Code</code>, and <code>TraceId</code>.</li>
<li><strong>Example:</strong></li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="na">[Fact]</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">AgainstTooShort_ReturnsError_WhenBelowThreshold</span><span class="p">()</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="p">{</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GuardOptions</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">TraceId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;unit-1&quot;</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Guard</span><span class="p">.</span><span class="n">AgainstTooShort</span><span class="p">(</span><span class="s">&quot;ab&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p">);</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">    </span><span class="n">result</span><span class="p">.</span><span class="n">IsFailure</span><span class="p">.</span><span class="n">Should</span><span class="p">().</span><span class="n">BeTrue</span><span class="p">();</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">    </span><span class="n">result</span><span class="p">.</span><span class="n">Errors</span><span class="p">.</span><span class="n">Single</span><span class="p">().</span><span class="n">Code</span><span class="p">.</span><span class="n">Should</span><span class="p">().</span><span class="n">Be</span><span class="p">(</span><span class="s">&quot;guard.length&quot;</span><span class="p">);</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">    </span><span class="n">result</span><span class="p">.</span><span class="n">TraceId</span><span class="p">.</span><span class="n">Should</span><span class="p">().</span><span class="n">Be</span><span class="p">(</span><span class="s">&quot;unit-1&quot;</span><span class="p">);</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="p">}</span>
</code></pre></div>
<ul>
<li><strong>Accumulate mode:</strong> Assert that the error sink contains all errors and that the returned <code>Result</code> is failure.</li>
</ul>
<h2 id="performance-considerations">Performance considerations<a class="headerlink" href="#performance-considerations" title="Permanent link">&para;</a></h2>
<ul>
<li>Guards are lightweight and allocation-friendly (simple Error structs, minimal collections). The main cost in accumulation mode is list growth; reuse sinks where appropriate for large batches.</li>
<li>For high-frequency hot paths, prefer <code>ReturnFailure</code> to avoid exception costs. Reserve <code>Throw</code> for places where exceptions are part of your existing contract.</li>
</ul>
<h2 id="extending-guards">Extending guards<a class="headerlink" href="#extending-guards" title="Permanent link">&para;</a></h2>
<p>You can add custom guards alongside the built-ins by wrapping <code>Ensure</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">GuardExtras</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="p">{</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">Result</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">AgainstWeekend</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">DateOnly</span><span class="w"> </span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">parameterName</span><span class="p">,</span><span class="w"> </span><span class="n">GuardOptions</span><span class="o">?</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">isWeekend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">date</span><span class="p">.</span><span class="n">DayOfWeek</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">DayOfWeek</span><span class="p">.</span><span class="n">Saturday</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">DayOfWeek</span><span class="p">.</span><span class="n">Sunday</span><span class="p">;</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Guard</span><span class="p">.</span><span class="n">Ensure</span><span class="p">(</span><span class="o">!</span><span class="n">isWeekend</span><span class="p">,</span><span class="w"> </span><span class="s">$&quot;date.{parameterName}.weekend&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">$&quot;{parameterName} cannot fall on a weekend.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p">)</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">            </span><span class="p">.</span><span class="n">Map</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="p">)(</span><span class="kt">object</span><span class="p">)</span><span class="n">date</span><span class="p">);</span><span class="w"> </span><span class="c1">// or return Result.Success(date, options?.TraceId)</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="p">}</span>
</code></pre></div>
<p>Keep codes prefixed by the domain area to avoid collisions (<code>inventory.*</code>, <code>billing.*</code>, etc.).</p>
<h2 id="adoption-playbook">Adoption playbook<a class="headerlink" href="#adoption-playbook" title="Permanent link">&para;</a></h2>
<ol>
<li><strong>Configure defaults:</strong> Set <code>Extensions:Core:GuardStrategy</code> to <code>ReturnFailure</code> (recommended). Enable a correlation-aware <code>TraceId</code> if you have one.</li>
<li><strong>Update new handlers:</strong> Use guards at the top of handlers to validate inputs, returning <code>Result&lt;T&gt;</code> on failure.</li>
<li><strong>Add accumulation for batch workflows:</strong> Introduce <code>Accumulate</code> + sinks where you previously looped over items with ad hoc validation.</li>
<li><strong>Bridge to existing exception flows:</strong> Where middleware expects exceptions, set strategy to <code>Throw</code> or wrap guard results in exceptions until you migrate clients.</li>
<li><strong>Refine codes/messages:</strong> Standardize error codes across teams. Document them near your domain services or in a shared constants file.</li>
</ol>
<h2 id="reference-methods-and-codes">Reference: Methods and codes<a class="headerlink" href="#reference-methods-and-codes" title="Permanent link">&para;</a></h2>
<ul>
<li><code>AgainstNull</code> → <code>guard.null</code></li>
<li><code>AgainstNullOrWhiteSpace</code> → <code>guard.empty</code></li>
<li><code>AgainstOutOfRange</code> → <code>guard.range</code></li>
<li><code>AgainstUndefinedEnum</code> → <code>guard.enum</code></li>
<li><code>AgainstTooShort</code> → <code>guard.length</code></li>
<li><code>AgainstTooLong</code> → <code>guard.length</code></li>
<li><code>Ensure</code> → user-supplied code</li>
</ul>
<h2 id="related-docs">Related docs<a class="headerlink" href="#related-docs" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="../core/">Core extension overview</a> for pipeline behaviors, logging, time, domain events, and options.</li>
<li><a href="../core-result-primitives/">Core Result Primitives</a> to see how guard outputs compose with results and downstream handlers.</li>
<li><a href="../validation/">Validation extension</a> when you need FluentValidation-driven behaviors in addition to guards.</li>
</ul>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">December 3, 2025</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.tracking", "content.code.copy", "content.tabs.link", "search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8d2eff1.min.js"></script>
      
    
  </body>
</html>